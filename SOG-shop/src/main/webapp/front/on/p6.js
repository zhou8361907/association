!function(l,g){function q(h,k){for(var f,b=[],a=0;a<h.length;++a){var e;if(!(e=v[h[a]]))a:{e=l;for(var d=h[a].split(/[.\/]/),r=0;r<d.length;++r){if(!e[d[r]]){e=void 0;break a}e=e[d[r]]}}if(f=e,!f)throw"module definition dependecy not found: "+h[a];b.push(f)}k.apply(null,b)}function m(h,k,f){if("string"!=typeof h)throw"invalid module definition, module id must be defined and be a string";if(k===g)throw"invalid module definition, dependencies must be specified";if(f===g)throw"invalid module definition, definition function must be specified";q(k,function(){v[h]=f.apply(null,arguments)})}var v={};m("moxie/core/utils/Basic",[],function(){var h=function(a){return void 0===a?"undefined":null===a?"null":a.nodeType?"node":{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},k=function(a){return f(arguments,function(e,d){0<d&&f(e,function(d,e){void 0!==d&&(h(a[e])===h(d)&&~b(h(d),["array","object"])?k(a[e],d):a[e]=d)})}),a},f=function(a,b){var d,e;if(a)if("number"===h(a.length))for(e=0,d=a.length;d>e&&!1!==b(a[e],e);e++);else if("object"===h(a))for(d in a)if(a.hasOwnProperty(d)&&!1===b(a[d],d))break},b=function(a,b){if(b){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(b,a);for(var d=0,e=b.length;e>d;d++)if(b[d]===a)return d}return-1};return{guid:function(){var a=0;return function(b){var d=(new Date).getTime().toString(32),e;for(e=0;5>e;e++)d+=Math.floor(65535*Math.random()).toString(32);return(b||"o_")+d+(a++).toString(32)}}(),typeOf:h,extend:k,each:f,isEmptyObj:function(a){var b;if(!a||"object"!==h(a))return!0;for(b in a)return!1;return!0},inSeries:function(a,b){function d(c){"function"===h(a[c])&&a[c](function(a){++c<e&&!a?d(c):b(a)})}var e=a.length;"function"!==h(b)&&(b=function(){});a&&a.length||b();d(0)},inParallel:function(a,b){var d=0,e=a.length,c=Array(e);f(a,function(a,f){a(function(a){if(a)return b(a);var p=[].slice.call(arguments);p.shift();c[f]=p;d++;d===e&&(c.unshift(null),b.apply(this,c))})})},inArray:b,arrayDiff:function(a,e){var d=[];"array"!==h(a)&&(a=[a]);"array"!==h(e)&&(e=[e]);for(var f in a)-1===b(a[f],e)&&d.push(a[f]);return d.length?d:!1},arrayIntersect:function(a,e){var d=[];return f(a,function(a){-1!==b(a,e)&&d.push(a)}),d.length?d:null},toArray:function(a){var b,d=[];for(b=0;b<a.length;b++)d[b]=a[b];return d},trim:function(a){return a?String.prototype.trim?String.prototype.trim.call(a):a.toString().replace(/^\s*/,"").replace(/\s*$/,""):a},sprintf:function(a){var b=[].slice.call(arguments,1);return a.replace(/%[a-z]/g,function(){var a=b.shift();return"undefined"!==h(a)?a:""})},parseSizeStr:function(a){if("string"!=typeof a)return a;var b={t:1099511627776,g:1073741824,m:1048576,k:1024},d;return a=/^([0-9\.]+)([tmgk]?)$/.exec(a.toLowerCase().replace(/[^0-9\.tmkg]/g,"")),d=a[2],a=+a[1],b.hasOwnProperty(d)&&(a*=b[d]),Math.floor(a)}}});m("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(h){var k=function(a){var b={has:function(a,b){return-1!==b.toLowerCase().indexOf(a.toLowerCase())},lowerize:function(a){return a.toLowerCase()}},e=function(){for(var b,d=0,c,e,p,f,r,n=arguments;d<n.length;d+=2){r=n[d];var t=n[d+1];if("undefined"===typeof b)for(p in b={},t)c=t[p],"object"===typeof c?b[c[0]]=a:b[c]=a;for(c=e=0;c<r.length;c++)if(f=r[c].exec(this.getUA())){for(p=0;p<t.length;p++)r=f[++e],c=t[p],"object"===typeof c&&0<c.length?2==c.length?"function"==typeof c[1]?b[c[0]]=c[1].call(this,r):b[c[0]]=c[1]:3==c.length?"function"!==typeof c[1]||c[1].exec&&c[1].test?b[c[0]]=r?r.replace(c[1],c[2]):a:b[c[0]]=r?c[1].call(this,r,c[2]):a:4==c.length&&(b[c[0]]=r?c[3].call(this,r.replace(c[1],c[2])):a):b[c]=r?r:a;break}if(f)break}return b},c=function(c,d){for(var e in d)if("object"===typeof d[e]&&0<d[e].length)for(var p=0;p<d[e].length;p++){if(b.has(d[e][p],c))return"?"===e?a:e}else if(b.has(d[e],c))return"?"===e?a:e;return c},f={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2E3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",RT:"ARM"},t=[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],["name","version"],[/\s(opr)\/([\w\.]+)/i],[["name","Opera"],"version"],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],["name","version"],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[["name","IE"],"version"],[/(edge)\/((\d+)?[\w\.]+)/i],["name","version"],[/(yabrowser)\/([\w\.]+)/i],[["name","Yandex"],"version"],[/(comodo_dragon)\/([\w\.]+)/i],[["name",/_/g," "],"version"],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],["name","version"],[/(dolfin)\/([\w\.]+)/i],[["name","Dolphin"],"version"],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[["name","Chrome"],"version"],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],["version",["name","MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],["version",["name","Android Browser"]],[/FBAV\/([\w\.]+);/i],["version",["name","Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],["version",["name","Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],["version","name"],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],["name",["version",c,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],["name","version"],[/(navigator|netscape)\/([\w\.-]+)/i],[["name","Netscape"],"version"],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],["name","version"]],p=[[/windows.+\sedge\/([\w\.]+)/i],["version",["name","EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],["name","version"],[/rv\:([\w\.]+).*(gecko)/i],["version","name"]],h=[[/microsoft\s(windows)\s(vista|xp)/i],["name","version"],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],["name",["version",c,f]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[["name","Windows"],["version",c,f]],[/\((bb)(10);/i],[["name","BlackBerry"],"version"],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],["name","version"],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[["name","Symbian"],"version"],[/\((series40);/i],["name"],[/mozilla.+\(mobile;.+gecko.+firefox/i],[["name","Firefox OS"],"version"],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],["name","version"],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[["name","Chromium OS"],"version"],[/(sunos)\s?([\w\.]+\d)*/i],[["name","Solaris"],"version"],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],["name","version"],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[["name","iOS"],["version",/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[["name","Mac OS"],["version",/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],["name","version"]];return function(a){var b=a||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"");this.getBrowser=function(){return e.apply(this,t)};this.getEngine=function(){return e.apply(this,p)};this.getOS=function(){return e.apply(this,h)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}};this.getUA=function(){return b};this.setUA=function(a){return b=a,this};this.setUA(b)}}(),f=function(){var b={define_property:!1,create_canvas:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}(),return_response_type:function(a){try{if(-1!==h.inArray(a,["","text","document"]))return!0;if(window.XMLHttpRequest){var b=new XMLHttpRequest;if(b.open("get","/"),"responseType"in b)return b.responseType=a,b.responseType!==a?!1:!0}}catch(c){}return!1},use_data_uri:function(){var a=new Image;return a.onload=function(){b.use_data_uri=1===a.width&&1===a.height},setTimeout(function(){a.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw\x3d\x3d"},1),!1}(),use_data_uri_over32kb:function(){return b.use_data_uri&&("IE"!==a.browser||9<=a.version)},use_data_uri_of:function(a){return b.use_data_uri&&33E3>a||b.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;var a=document.createElement("input");return a.setAttribute("type","file"),!a.disabled}};return function(a){var d=[].slice.call(arguments);return d.shift(),"function"===h.typeOf(b[a])?b[a].apply(this,d):!!b[a]}}(),b=(new k).getResult(),a={can:f,uaParser:k,browser:b.browser.name,version:b.browser.version,os:b.os.name,osVersion:b.os.version,verComp:function(a,b,f){var c=0,d=0,e=0,p={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},c=function(a){return a=(""+a).replace(/[_\-+]/g,"."),a=a.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),a.length?a.split("."):[-8]},r=function(a){return a?isNaN(a)?p[a]||-7:parseInt(a,10):0};a=c(a);b=c(b);d=Math.max(a.length,b.length);for(c=0;d>c;c++)if(a[c]!=b[c]){if(a[c]=r(a[c]),b[c]=r(b[c]),a[c]<b[c]){e=-1;break}if(a[c]>b[c]){e=1;break}}if(!f)return e;switch(f){case "\x3e":case "gt":return 0<e;case "\x3e\x3d":case "ge":return 0<=e;case "\x3c\x3d":case "le":return 0>=e;case "\x3d\x3d":case "\x3d":case "eq":return 0===e;case "\x3c\x3e":case "!\x3d":case "ne":return 0!==e;case "":case "\x3c":case "lt":return 0>e;default:return null}},swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return a.OS=a.os,a});m("moxie/core/I18n",["moxie/core/utils/Basic"],function(h){var k={};return{addI18n:function(f){return h.extend(k,f)},translate:function(f){return k[f]||f},_:function(f){return this.translate(f)},sprintf:function(f){var b=[].slice.call(arguments,1);return f.replace(/%[a-z]/g,function(){var a=b.shift();return"undefined"!==h.typeOf(a)?a:""})}}});m("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(h,k){var f={mimes:{},extensions:{},addMimeType:function(b){b=b.split(/,/);var a,e,d;for(a=0;a<b.length;a+=2){d=b[a+1].split(/ /);for(e=0;e<d.length;e++)this.mimes[d[e]]=b[a];this.extensions[b[a]]=d}},extList2mimes:function(b,a){var e,d,f,c,n=[];for(d=0;d<b.length;d++)for(e=b[d].extensions.split(/\s*,\s*/),f=0;f<e.length;f++){if("*"===e[f])return[];if(c=this.mimes[e[f]],c&&-1===h.inArray(c,n)&&n.push(c),a&&/^\w+$/.test(e[f]))n.push("."+e[f]);else if(!c)return[]}return n},mimes2exts:function(b){var a=this,e=[];return h.each(b,function(b){if("*"===b)return e=[],!1;var d=b.match(/^(\w+)\/(\*|\w+)$/);d&&("*"===d[2]?h.each(a.extensions,function(b,f){(new RegExp("^"+d[1]+"/")).test(f)&&[].push.apply(e,a.extensions[f])}):a.extensions[b]&&[].push.apply(e,a.extensions[b]))}),e},mimes2extList:function(b){var a=[],e=[];return"string"===h.typeOf(b)&&(b=h.trim(b).split(/\s*,\s*/)),e=this.mimes2exts(b),a.push({title:k.translate("Files"),extensions:e.length?e.join(","):"*"}),a.mimes=b,a},getFileExtension:function(b){return(b=b&&b.match(/\.([^.]+)$/))?b[1].toLowerCase():""},getFileMime:function(b){return this.mimes[this.getFileExtension(b)]||""}};return f.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe"),f});m("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(h){var k=function(f,b){return f.className?(new RegExp("(^|\\s+)"+b+"(\\s+|$)")).test(f.className):!1};return{get:function(f){return"string"!=typeof f?f:document.getElementById(f)},hasClass:k,addClass:function(f,b){k(f,b)||(f.className=f.className?f.className.replace(/\s+$/,"")+" "+b:b)},removeClass:function(f,b){f.className&&(f.className=f.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)"),function(a,b,d){return" "===b&&" "===d?" ":""}))},getStyle:function(f,b){return f.currentStyle?f.currentStyle[b]:window.getComputedStyle?window.getComputedStyle(f,null)[b]:void 0},getPos:function(f,b){function a(a){var b,d,e=0,f=0;return a&&(d=a.getBoundingClientRect(),b="CSS1Compat"===c.compatMode?c.documentElement:c.body,e=d.left+b.scrollLeft,f=d.top+b.scrollTop),{x:e,y:f}}var e=0,d=0,r,c=document,n;if(b=b||c.body,f&&f.getBoundingClientRect&&"IE"===h.browser&&(!c.documentMode||8>c.documentMode))return r=a(f),n=a(b),{x:r.x-n.x,y:r.y-n.y};for(r=f;r&&r!=b&&r.nodeType;)e+=r.offsetLeft||0,d+=r.offsetTop||0,r=r.offsetParent;for(r=f.parentNode;r&&r!=b&&r.nodeType;)e-=r.scrollLeft||0,d-=r.scrollTop||0,r=r.parentNode;return{x:e,y:d}},getSize:function(f){return{w:f.offsetWidth||f.clientWidth,h:f.offsetHeight||f.clientHeight}}}});m("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(h){function k(f,b){for(var a in f)if(f[a]===b)return a;return null}return{RuntimeError:function(){function f(a){this.code=a;this.name=k(b,a);this.message=this.name+": RuntimeError "+this.code}var b={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return h.extend(f,b),f.prototype=Error.prototype,f}(),OperationNotAllowedException:function(){function f(b){this.code=b;this.name="OperationNotAllowedException"}return h.extend(f,{NOT_ALLOWED_ERR:1}),f.prototype=Error.prototype,f}(),ImageError:function(){function f(a){this.code=a;this.name=k(b,a);this.message=this.name+": ImageError "+this.code}var b={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};return h.extend(f,b),f.prototype=Error.prototype,f}(),FileException:function(){function f(a){this.code=a;this.name=k(b,a);this.message=this.name+": FileException "+this.code}var b={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return h.extend(f,b),f.prototype=Error.prototype,f}(),DOMException:function(){function f(a){this.code=a;this.name=k(b,a);this.message=this.name+": DOMException "+this.code}var b={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return h.extend(f,b),f.prototype=Error.prototype,f}(),EventException:function(){function f(b){this.code=b;this.name="EventException"}return h.extend(f,{UNSPECIFIED_EVENT_TYPE_ERR:0}),f.prototype=Error.prototype,f}()}});m("moxie/core/EventTarget",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic"],function(h,k,f){function b(){var a={};f.extend(this,{uid:null,init:function(){this.uid||(this.uid=f.guid("uid_"))},addEventListener:function(b,d,r,c){var e=this,h;return this.hasOwnProperty("uid")||(this.uid=f.guid("uid_")),b=f.trim(b),/\s/.test(b)?void f.each(b.split(/\s+/),function(a){e.addEventListener(a,d,r,c)}):(b=b.toLowerCase(),r=parseInt(r,10)||0,h=a[this.uid]&&a[this.uid][b]||[],h.push({fn:d,priority:r,scope:c||this}),a[this.uid]||(a[this.uid]={}),void(a[this.uid][b]=h))},hasEventListener:function(b){return(b=b?a[this.uid]&&a[this.uid][b]:a[this.uid])?b:!1},removeEventListener:function(b,d){b=b.toLowerCase();var e=a[this.uid]&&a[this.uid][b],c;if(e){if(d)for(c=e.length-1;0<=c;c--){if(e[c].fn===d){e.splice(c,1);break}}else e=[];e.length||(delete a[this.uid][b],f.isEmptyObj(a[this.uid])&&delete a[this.uid])}},removeAllEventListeners:function(){a[this.uid]&&delete a[this.uid]},dispatchEvent:function(b){var d,e,c,n={},h=!0;if("string"!==f.typeOf(b)){if(e=b,"string"!==f.typeOf(e.type))throw new k.EventException(k.EventException.UNSPECIFIED_EVENT_TYPE_ERR);b=e.type;void 0!==e.total&&void 0!==e.loaded&&(n.total=e.total,n.loaded=e.loaded);n.async=e.async||!1}if(-1!==b.indexOf("::")?!function(a){d=a[0];b=a[1]}(b.split("::")):d=this.uid,b=b.toLowerCase(),e=a[d]&&a[d][b]){e.sort(function(a,b){return b.priority-a.priority});c=[].slice.call(arguments);c.shift();n.type=b;c.unshift(n);var p=[];f.each(e,function(a){c[0].target=a.scope;p.push(n.async?function(b){setTimeout(function(){b(!1===a.fn.apply(a.scope,c))},1)}:function(b){b(!1===a.fn.apply(a.scope,c))})});p.length&&f.inSeries(p,function(a){h=!a})}return h},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(a){var b=this;this.bind(a.join(" "),function(a){var b="on"+a.type.toLowerCase();"function"===f.typeOf(this[b])&&this[b].apply(this,arguments)});f.each(a,function(a){a="on"+a.toLowerCase(a);"undefined"===f.typeOf(b[a])&&(b[a]=null)})}})}return b.instance=new b,b});m("moxie/runtime/Runtime",["moxie/core/utils/Env","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(h,k,f,b){function a(b,c,e,h,p){var n=this,r,t=k.guid(c+"_");p=p||"browser";b=b||{};d[t]=this;e=k.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},e);b.preferred_caps&&(p=a.getMode(h,b.preferred_caps,p));r=function(){var a={};return{exec:function(b,c,d,e){return r[c]&&(a[b]||(a[b]={context:this,instance:new r[c]}),a[b].instance[d])?a[b].instance[d].apply(this,e):void 0},removeInstance:function(b){delete a[b]},removeAllInstances:function(){var b=this;k.each(a,function(a,c){"function"===k.typeOf(a.instance.destroy)&&a.instance.destroy.call(a.context);b.removeInstance(c)})}}}();k.extend(this,{initialized:!1,uid:t,type:c,mode:a.getMode(h,b.required_caps,p),shimid:t+"_container",clients:0,options:b,can:function(b,c,d){d=d||e;if("string"===k.typeOf(b)&&"undefined"===k.typeOf(c)&&(b=a.parseCaps(b)),"object"===k.typeOf(b)){for(var f in b)if(!this.can(f,b[f],d))return!1;return!0}return"function"===k.typeOf(d[b])?d[b].call(this,c):c===d[b]},getShimContainer:function(){var a,b=f.get(this.shimid);return b||(a=this.options.container?f.get(this.options.container):document.body,b=document.createElement("div"),b.id=this.shimid,b.className="moxie-shim moxie-shim-"+this.type,k.extend(b.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),a.appendChild(b)),b},getShim:function(){return r},shimExec:function(a,b){var c=[].slice.call(arguments,2);return n.getShim().exec.call(this,this.uid,a,b,c)},exec:function(a,b){var c=[].slice.call(arguments,2);return n[a]&&n[a][b]?n[a][b].apply(this,c):n.shimExec.apply(this,arguments)},destroy:function(){if(n){var a=f.get(this.shimid);a&&a.parentNode.removeChild(a);r&&r.removeAllInstances();this.unbindAll();delete d[this.uid];t=n=r=this.uid=null}}});this.mode&&b.required_caps&&!this.can(b.required_caps)&&(this.mode=!1)}var e={},d={};return a.order="html5,flash,silverlight,html4",a.getRuntime=function(a){return d[a]?d[a]:!1},a.addConstructor=function(a,c){c.prototype=b.instance;e[a]=c},a.getConstructor=function(a){return e[a]||null},a.getInfo=function(b){var c=a.getRuntime(b);return c?{uid:c.uid,type:c.type,mode:c.mode,can:function(){return c.can.apply(c,arguments)}}:null},a.parseCaps=function(a){var b={};return"string"!==k.typeOf(a)?a||{}:(k.each(a.split(","),function(a){b[a]=!0}),b)},a.can=function(b,c){var d;b=a.getConstructor(b);var e;return b?(d=new b({required_caps:c}),e=d.mode,d.destroy(),!!e):!1},a.thatCan=function(b,c){c=(c||a.order).split(/\s*,\s*/);for(var d in c)if(a.can(c[d],b))return c[d];return null},a.getMode=function(a,b,d){var c=null;if("undefined"===k.typeOf(d)&&(d="browser"),b&&!k.isEmptyObj(a)){if(k.each(b,function(b,d){if(a.hasOwnProperty(d))if(b=a[d](b),"string"==typeof b&&(b=[b]),c){if(!(c=k.arrayIntersect(c,b)))return c=!1}else c=b}),c)return-1!==k.inArray(d,c)?d:c[0];if(!1===c)return!1}return d},a.capTrue=function(){return!0},a.capFalse=function(){return!1},a.capTest=function(a){return function(){return!!a}},a});m("moxie/runtime/RuntimeClient",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(h,k,f,b){return function(){var a;f.extend(this,{connectRuntime:function(e){function d(c){var f,p;return c.length?(f=c.shift().toLowerCase(),(p=b.getConstructor(f))?(a=new p(e),a.bind("Init",function(){a.initialized=!0;setTimeout(function(){a.clients++;h.trigger("RuntimeInit",a)},1)}),a.bind("Error",function(){a.destroy();d(c)}),a.mode?void a.init():void a.trigger("Error")):void d(c)):(h.trigger("RuntimeError",new k.RuntimeError(k.RuntimeError.NOT_INIT_ERR)),void(a=null))}var h=this,c;if("string"===f.typeOf(e)?c=e:"string"===f.typeOf(e.ruid)&&(c=e.ruid),c){if(a=b.getRuntime(c))return a.clients++,a;throw new k.RuntimeError(k.RuntimeError.NOT_INIT_ERR);}d((e.runtime_order||b.order).split(/\s*,\s*/))},disconnectRuntime:function(){a&&0>=--a.clients&&a.destroy();a=null},getRuntime:function(){return a&&a.uid?a:a=null},exec:function(){return a?a.exec.apply(this,arguments):null}})}});m("moxie/file/FileInput","moxie/core/utils/Basic moxie/core/utils/Env moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/core/I18n moxie/runtime/Runtime moxie/runtime/RuntimeClient".split(" "),function(h,k,f,b,a,e,d,r,c){function n(e){var p=this,n;if(-1!==h.inArray(h.typeOf(e),["string","node"])&&(e={browse_button:e}),n=b.get(e.browse_button),!n)throw new a.DOMException(a.DOMException.NOT_FOUND_ERR);n={accept:[{title:d.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:n.parentNode||document.body};e=h.extend({},n,e);"string"==typeof e.required_caps&&(e.required_caps=r.parseCaps(e.required_caps));"string"==typeof e.accept&&(e.accept=f.mimes2extList(e.accept));(n=b.get(e.container))||(n=document.body);"static"===b.getStyle(n,"position")&&(n.style.position="relative");n=n=null;c.call(p);h.extend(p,{uid:h.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){p.bind("RuntimeInit",function(a,c){p.ruid=c.uid;p.shimid=c.shimid;p.bind("Ready",function(){p.trigger("Refresh")},999);p.bind("Refresh",function(){var a,d,f,p;f=b.get(e.browse_button);p=b.get(c.shimid);f&&(a=b.getPos(f,b.get(e.container)),d=b.getSize(f),p&&h.extend(p.style,{top:a.y+"px",left:a.x+
"px",width:d.w+"px",height:d.h+"px"}))});c.exec.call(p,"FileInput","init",e)});p.connectRuntime(h.extend({},e,{required_caps:{select_file:!0}}))},disable:function(a){var b=this.getRuntime();b&&b.exec.call(this,"FileInput","disable","undefined"===h.typeOf(a)?!0:a)},refresh:function(){p.trigger("Refresh")},destroy:function(){var a=this.getRuntime();a&&(a.exec.call(this,"FileInput","destroy"),this.disconnectRuntime());"array"===h.typeOf(this.files)&&h.each(this.files,function(a){a.destroy()});this.files=null;this.unbindAll()}});this.handleEventProps(g)}var g="ready change cancel mouseenter mouseleave mousedown mouseup".split(" ");return n.prototype=e.instance,n});m("moxie/core/utils/Encode",[],function(){var h=function(f){return unescape(encodeURIComponent(f))},k=function(f){return decodeURIComponent(escape(f))};return{utf8_encode:h,utf8_decode:k,atob:function(f,b){if("function"==typeof window.atob)return b?k(window.atob(f)):window.atob(f);var a,e,d,h,c,n=0,g=0,p="",A=[];if(!f)return f;f+="";do a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".indexOf(f.charAt(n++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".indexOf(f.charAt(n++)),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".indexOf(f.charAt(n++)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".indexOf(f.charAt(n++)),d=a<<18|e<<12|h<<6|c,a=d>>16&255,e=d>>8&255,d&=255,64==h?A[g++]=String.fromCharCode(a):64==c?A[g++]=String.fromCharCode(a,e):A[g++]=String.fromCharCode(a,e,d);while(n<f.length);return p=A.join(""),b?k(p):p},btoa:function(f,b){if(b&&(f=h(f)),"function"==typeof window.btoa)return window.btoa(f);var a,e,d,k,c=b=0,n=[];if(!f)return f;do a=f.charCodeAt(b++),e=f.charCodeAt(b++),d=f.charCodeAt(b++),k=a<<16|e<<8|d,a=k>>18&63,e=k>>12&63,d=k>>6&63,k&=63,n[c++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(d)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(k);while(b<f.length);b=n.join("");f=f.length%3;return(f?b.slice(0,f-3):b)+"\x3d\x3d\x3d".slice(f||3)}}});m("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(h,k,f){function b(e,d){function g(c,d,e){var f,n=a[this.uid];return"string"===h.typeOf(n)&&n.length?(f=new b(null,{type:e,size:d-c}),f.detach(n.substr(c,f.size)),f):null}f.call(this);e&&this.connectRuntime(e);d?"string"===h.typeOf(d)&&(d={data:d}):d={};h.extend(this,{uid:d.uid||h.guid("uid_"),ruid:e,size:d.size||0,type:d.type||"",slice:function(a,b,d){return this.isDetached()?g.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),a,b,d)},getSource:function(){return a[this.uid]?a[this.uid]:null},detach:function(b){if(this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),b=b||"","data:"==b.substr(0,5)){var c=b.indexOf(";base64,");this.type=b.substring(5,c);b=k.atob(b.substring(c+8))}this.size=b.length;a[this.uid]=b},isDetached:function(){return!this.ruid&&"string"===h.typeOf(a[this.uid])},destroy:function(){this.detach();delete a[this.uid]}});d.data?this.detach(d.data):a[this.uid]=d}var a={};return b});m("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(h,k,f){function b(a,b){b||(b={});f.apply(this,arguments);this.type||(this.type=k.getFileMime(b.name));var d;b.name?(d=b.name.replace(/\\/g,"/"),d=d.substr(d.lastIndexOf("/")+1)):this.type&&(d=this.type.split("/")[0],d=h.guid((""!==d?d:"file")+"_"),k.extensions[this.type]&&(d+="."+k.extensions[this.type][0]));h.extend(this,{name:d||h.guid("file_"),relativePath:"",lastModifiedDate:b.lastModifiedDate||(new Date).toLocaleString()})}return b.prototype=f.prototype,b});m("moxie/file/FileDrop","moxie/core/I18n moxie/core/utils/Dom moxie/core/Exceptions moxie/core/utils/Basic moxie/core/utils/Env moxie/file/File moxie/runtime/RuntimeClient moxie/core/EventTarget moxie/core/utils/Mime".split(" "),function(h,k,f,b,a,e,d,g,c){function n(a){var e=this,f;"string"==typeof a&&(a={drop_zone:a});f={accept:[{title:h.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}};a="object"==typeof a?b.extend({},f,a):f;a.container=k.get(a.drop_zone)||document.body;"static"===k.getStyle(a.container,"position")&&(a.container.style.position="relative");"string"==typeof a.accept&&(a.accept=c.mimes2extList(a.accept));d.call(e);b.extend(e,{uid:b.guid("uid_"),ruid:null,files:null,init:function(){e.bind("RuntimeInit",function(b,c){e.ruid=c.uid;c.exec.call(e,"FileDrop","init",a);e.dispatchEvent("ready")});e.connectRuntime(a)},destroy:function(){var a=this.getRuntime();a&&(a.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime());this.files=null;this.unbindAll()}});this.handleEventProps(r)}var r=["ready","dragenter","dragleave","drop","error"];return n.prototype=g.instance,n});m("moxie/file/FileReader","moxie/core/utils/Basic moxie/core/utils/Encode moxie/core/Exceptions moxie/core/EventTarget moxie/file/Blob moxie/runtime/RuntimeClient".split(" "),function(h,k,f,b,a,e){function d(){function b(b,c){if(this.trigger("loadstart"),this.readyState===d.LOADING)return this.trigger("error",new f.DOMException(f.DOMException.INVALID_STATE_ERR)),void this.trigger("loadend");if(!(c instanceof a))return this.trigger("error",new f.DOMException(f.DOMException.NOT_FOUND_ERR)),void this.trigger("loadend");if(this.result=null,this.readyState=d.LOADING,c.isDetached()){var e=c.getSource();switch(b){case "readAsText":case "readAsBinaryString":this.result=e;break;case "readAsDataURL":this.result="data:"+c.type+";base64,"+k.btoa(e)}this.readyState=d.DONE;this.trigger("load");this.trigger("loadend")}else this.connectRuntime(c.ruid),this.exec("FileReader","read",b,c)}e.call(this);h.extend(this,{uid:h.guid("uid_"),readyState:d.EMPTY,result:null,error:null,readAsBinaryString:function(a){b.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){b.call(this,"readAsDataURL",a)},readAsText:function(a){b.call(this,"readAsText",a)},abort:function(){this.result=null;-1===h.inArray(this.readyState,[d.EMPTY,d.DONE])&&(this.readyState===d.LOADING&&(this.readyState=d.DONE),this.exec("FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort();this.exec("FileReader","destroy");this.disconnectRuntime();this.unbindAll()}});this.handleEventProps(g);this.bind("Error",function(a,b){this.readyState=d.DONE;this.error=b},999);this.bind("Load",function(a){this.readyState=d.DONE},999)}var g="loadstart progress load abort error loadend".split(" ");return d.EMPTY=0,d.LOADING=1,d.DONE=2,d.prototype=b.instance,d});m("moxie/core/utils/Url",[],function(){var h=function(k,f){var b="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" "),a=b.length,e={http:80,https:443},d={};for(k=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(k||"");a--;)k[a]&&(d[b[a]]=k[a]);d.scheme||(f&&"string"!=typeof f||(f=h(f||document.location.href)),d.scheme=f.scheme,d.host=f.host,d.port=f.port,b="",/^[^\/]/.test(d.path)&&(b=f.path,b=/\/[^\/]*\.[^\/]*$/.test(b)?b.replace(/\/[^\/]+$/,"/"):b.replace(/\/?$/,"/")),d.path=b+(d.path||""));return d.port||(d.port=e[d.scheme]||80),d.port=parseInt(d.port,10),d.path||(d.path="/"),delete d.source,d};return{parseUrl:h,resolveUrl:function(k){k="object"==typeof k?k:h(k);return k.scheme+"://"+k.host+(k.port!=={http:80,https:443}[k.scheme]?":"+k.port:"")+k.path+(k.query?k.query:"")},hasSameOrigin:function(k){function f(b){return[b.scheme,b.host,b.port].join("/")}return"string"==typeof k&&(k=h(k)),f(h())===f(k)}}});m("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(h,k,f){function b(){this.uid=h.guid("uid_");k.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}return b.prototype=f.instance,b});m("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(h,k,f){return function(){function b(a,b){if(!b.isDetached()){var d=this.connectRuntime(b.ruid).exec.call(this,"FileReaderSync","read",a,b);return this.disconnectRuntime(),d}d=b.getSource();switch(a){case "readAsBinaryString":return d;case "readAsDataURL":return"data:"+b.type+";base64,"+f.btoa(d);case "readAsText":a="";b=0;for(var e=d.length;e>b;b++)a+=String.fromCharCode(d[b]);return a}}k.call(this);h.extend(this,{uid:h.guid("uid_"),readAsBinaryString:function(a){return b.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){return b.call(this,"readAsDataURL",a)},readAsText:function(a){return b.call(this,"readAsText",a)}})}});m("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(h,k,f){return function(){var b,a=[];k.extend(this,{append:function(e,d){var h=this,c=k.typeOf(d);d instanceof f?b={name:e,value:d}:"array"===c?(e+="[]",k.each(d,function(a){h.append(e,a)})):"object"===c?k.each(d,function(a,b){h.append(e+"["+b+"]",a)}):"null"===c||"undefined"===c||"number"===c&&isNaN(d)?h.append(e,"false"):a.push({name:e,value:d.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return b&&b.value||null},getBlobName:function(){return b&&b.name||null},each:function(e){k.each(a,function(a){e(a.value,a.name)});b&&e(b.value,b.name)},destroy:function(){b=null;a=[]}})}});m("moxie/xhr/XMLHttpRequest","moxie/core/utils/Basic moxie/core/Exceptions moxie/core/EventTarget moxie/core/utils/Encode moxie/core/utils/Url moxie/runtime/Runtime moxie/runtime/RuntimeTarget moxie/file/Blob moxie/file/FileReaderSync moxie/xhr/FormData moxie/core/utils/Env moxie/core/utils/Mime".split(" "),function(h,k,f,b,a,e,d,g,c,n,t,p){function r(){this.uid=h.guid("uid_")}function u(){function c(a,b){return D.hasOwnProperty(a)?1===arguments.length?t.can("define_property")?D[a]:A[a]:void(t.can("define_property")?D[a]=b:A[a]=b):void 0}function f(a){function b(){x&&(x.destroy(),x=null);p.dispatchEvent("loadend");p=null}function f(d){x.bind("LoadStart",function(a){c("readyState",u.LOADING);p.dispatchEvent("readystatechange");p.dispatchEvent(a);M&&p.upload.dispatchEvent(a)});x.bind("Progress",function(a){c("readyState")!==u.LOADING&&(c("readyState",u.LOADING),p.dispatchEvent("readystatechange"));p.dispatchEvent(a)});x.bind("UploadProgress",function(a){M&&p.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:a.total,loaded:a.loaded})});x.bind("Load",function(a){c("readyState",u.DONE);c("status",Number(d.exec.call(x,"XMLHttpRequest","getStatus")||0));c("statusText",l[c("status")]||"");c("response",d.exec.call(x,"XMLHttpRequest","getResponse",c("responseType")));~h.inArray(c("responseType"),["text",""])?c("responseText",c("response")):"document"===c("responseType")&&c("responseXML",c("response"));J=d.exec.call(x,"XMLHttpRequest","getAllResponseHeaders");p.dispatchEvent("readystatechange");0<c("status")?(M&&p.upload.dispatchEvent(a),p.dispatchEvent(a)):(K=!0,p.dispatchEvent("error"));b()});x.bind("Abort",function(a){p.dispatchEvent(a);b()});x.bind("Error",function(a){K=!0;c("readyState",u.DONE);p.dispatchEvent("readystatechange");E=!0;p.dispatchEvent(a);b()});d.exec.call(x,"XMLHttpRequest","send",{url:R,method:q,async:m,user:z,password:B,headers:y,mimeType:I,encoding:v,responseType:p.responseType,withCredentials:p.withCredentials,options:w},a)}var p=this;(new Date).getTime();x=new d;"string"==typeof w.required_caps&&(w.required_caps=e.parseCaps(w.required_caps));w.required_caps=h.extend({},w.required_caps,{return_response_type:p.responseType});a instanceof n&&(w.required_caps.send_multipart=!0);h.isEmptyObj(y)||(w.required_caps.send_custom_headers=!0);S||(w.required_caps.do_cors=!0);w.ruid?f(x.connectRuntime(w)):(x.bind("RuntimeInit",function(a,b){f(b)}),x.bind("RuntimeError",function(a,b){p.dispatchEvent("RuntimeError",b)}),x.connectRuntime(w))}var A=this,D={timeout:0,readyState:u.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},m=!0,R,q,y={},z,B,v=null,I=null,Q=!1,F=!1,M=!1,E=!1,K=!1,S=!1,w={},x,J="",T;h.extend(this,D,{uid:h.guid("uid_"),upload:new r,open:function(d,w,f,e,p){var x;if(!d||!w)throw new k.DOMException(k.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(d)||b.utf8_encode(d)!==d)throw new k.DOMException(k.DOMException.SYNTAX_ERR);if(~h.inArray(d.toUpperCase(),"CONNECT DELETE GET HEAD OPTIONS POST PUT TRACE TRACK".split(" "))&&(q=d.toUpperCase()),~h.inArray(q,["CONNECT","TRACE","TRACK"]))throw new k.DOMException(k.DOMException.SECURITY_ERR);if(w=b.utf8_encode(w),x=a.parseUrl(w),S=a.hasSameOrigin(x),R=a.resolveUrl(w),(e||p)&&!S)throw new k.DOMException(k.DOMException.INVALID_ACCESS_ERR);if(z=e||x.user,B=p||x.pass,m=f||!0,!1===m&&(c("timeout")||c("withCredentials")||""!==c("responseType")))throw new k.DOMException(k.DOMException.INVALID_ACCESS_ERR);Q=!m;F=!1;y={};c("responseText","");c("responseXML",null);c("response",null);c("status",0);c("statusText","");c("readyState",u.OPENED);this.dispatchEvent("readystatechange")},setRequestHeader:function(a,d){if(c("readyState")!==u.OPENED||F)throw new k.DOMException(k.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(a)||b.utf8_encode(a)!==a)throw new k.DOMException(k.DOMException.SYNTAX_ERR);return a=h.trim(a).toLowerCase(),~h.inArray(a,"accept-charset accept-encoding access-control-request-headers access-control-request-method connection content-length cookie cookie2 content-transfer-encoding date expect host keep-alive origin referer te trailer transfer-encoding upgrade user-agent via".split(" "))||/^(proxy\-|sec\-)/.test(a)?!1:(y[a]?y[a]+=", "+d:y[a]=d,!0)},getAllResponseHeaders:function(){return J||""},getResponseHeader:function(a){return a=a.toLowerCase(),K||~h.inArray(a,["set-cookie","set-cookie2"])?null:J&&""!==J&&(T||(T={},h.each(J.split(/\r\n/),function(a){a=a.split(/:\s+/);2===a.length&&(a[0]=h.trim(a[0]),T[a[0].toLowerCase()]={header:a[0],value:h.trim(a[1])})})),T.hasOwnProperty(a))?T[a].header+": "+T[a].value:null},overrideMimeType:function(a){var b;if(~h.inArray(c("readyState"),[u.LOADING,u.DONE]))throw new k.DOMException(k.DOMException.INVALID_STATE_ERR);if(a=h.trim(a.toLowerCase()),/;/.test(a)&&(b=a.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(a=b[1]),!p.mimes[a])throw new k.DOMException(k.DOMException.SYNTAX_ERR);},send:function(a,c){if(w="string"===h.typeOf(c)?{ruid:c}:c?c:{},this.readyState!==u.OPENED||F)throw new k.DOMException(k.DOMException.INVALID_STATE_ERR);a instanceof g?(w.ruid=a.ruid,I=a.type||"application/octet-stream"):a instanceof n?a.hasBlob()&&(c=a.getBlob(),w.ruid=c.ruid,I=c.type||"application/octet-stream"):"string"==typeof a&&(v="UTF-8",I="text/plain;charset\x3dUTF-8",a=b.utf8_encode(a));this.withCredentials||(this.withCredentials=w.required_caps&&w.required_caps.send_browser_cookies&&!S);M=!Q&&this.upload.hasEventListener();K=!1;E=!a;Q||(F=!0);f.call(this,a)},abort:function(){if(K=!0,Q=!1,~h.inArray(c("readyState"),[u.UNSENT,u.OPENED,u.DONE]))c("readyState",u.UNSENT);else{if(c("readyState",u.DONE),F=!1,!x)throw new k.DOMException(k.DOMException.INVALID_STATE_ERR);x.getRuntime().exec.call(x,"XMLHttpRequest","abort",E);E=!0}},destroy:function(){x&&("function"===h.typeOf(x.destroy)&&x.destroy(),x=null);this.unbindAll();this.upload&&(this.upload.unbindAll(),this.upload=null)}});this.handleEventProps(N.concat(["readystatechange"]));this.upload.handleEventProps(N)}var l={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};r.prototype=f.instance;var N="loadstart progress abort error load timeout loadend".split(" ");return u.UNSENT=0,u.OPENED=1,u.HEADERS_RECEIVED=2,u.LOADING=3,u.DONE=4,u.prototype=f.instance,u});m("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(h,k,f,b){function a(){function b(b,f){var e=this;c=f;e.bind("TransportingProgress",function(b){p=b.loaded;t>p&&-1===h.inArray(e.state,[a.IDLE,a.DONE])&&d.call(e)},999);e.bind("TransportingComplete",function(){p=t;e.state=a.DONE;n=null;e.result=c.exec.call(e,"Transporter","getAsBlob",b||"")},999);e.state=a.BUSY;e.trigger("TransportingStarted");d.call(e)}function d(){var a;a=t-p;A>a&&(A=a);a=k.btoa(n.substr(p,A));c.exec.call(this,"Transporter","receive",a,t)}var g,c,n,t,p,A;f.call(this);h.extend(this,{uid:h.guid("uid_"),state:a.IDLE,result:null,transport:function(a,c,d){var e=this;d=h.extend({chunk_size:204798},d);(g=d.chunk_size%3)&&(d.chunk_size+=3-g);A=d.chunk_size;t=p=0;n=this.result=null;if(n=a,t=a.length,"string"===h.typeOf(d)||d.ruid)b.call(e,c,this.connectRuntime(d));else{var f=function(a,d){e.unbind("RuntimeInit",f);b.call(e,c,d)};this.bind("RuntimeInit",f);this.connectRuntime(d)}},abort:function(){this.state=a.IDLE;c&&(c.exec.call(this,"Transporter","clear"),this.trigger("TransportingAborted"));t=p=0;n=this.result=null},destroy:function(){this.unbindAll();c=null;this.disconnectRuntime();t=p=0;n=this.result=null}})}return a.IDLE=0,a.BUSY=1,a.DONE=2,a.prototype=b.instance,a});m("moxie/image/Image","moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/Exceptions moxie/file/FileReaderSync moxie/xhr/XMLHttpRequest moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/runtime/Transporter moxie/core/utils/Env moxie/core/EventTarget moxie/file/Blob moxie/file/File moxie/core/utils/Encode".split(" "),function(h,g,f,b,a,e,d,r,c,n,t,p,A){function k(){function b(a){var c=h.typeOf(a);try{if(a instanceof k){if(!a.size)throw new f.DOMException(f.DOMException.INVALID_STATE_ERR);n.apply(this,arguments)}else if(a instanceof t){if(!~h.inArray(a.type,["image/jpeg","image/png"]))throw new f.ImageError(f.ImageError.WRONG_FORMAT);u.apply(this,arguments)}else if(-1!==h.inArray(c,["blob","file"]))b.call(this,new p(null,a),arguments[1]);else if("string"===c)"data:"===a.substr(0,5)?b.call(this,new t(null,{data:a}),arguments[1]):m.apply(this,arguments);else{if("node"!==c||"img"!==a.nodeName.toLowerCase())throw new f.DOMException(f.DOMException.TYPE_MISMATCH_ERR);b.call(this,a.src,arguments[1])}}catch(L){this.trigger("error",L.code)}}function n(a,b){var c=this.connectRuntime(a.ruid);this.ruid=c.uid;c.exec.call(this,"Image","loadFromImage",a,"undefined"===h.typeOf(b)?!0:b)}function u(a,b){function c(b){d.ruid=b.uid;b.exec.call(d,"Image","loadFromBlob",a)}var d=this;d.name=a.name||"";a.isDetached()?(this.bind("RuntimeInit",function(a,b){c(b)}),b&&"string"==typeof b.required_caps&&(b.required_caps=e.parseCaps(b.required_caps)),this.connectRuntime(h.extend({required_caps:{access_image_binary:!0,resize_image:!0}},b))):c(this.connectRuntime(a.ruid))}function m(b,c){var d=this,e;e=new a;e.open("get",b);e.responseType="blob";e.onprogress=function(a){d.trigger(a)};e.onload=function(){u.call(d,e.response,!0)};e.onerror=function(a){d.trigger(a)};e.onloadend=function(){e.destroy()};e.bind("RuntimeError",function(a,b){d.trigger("RuntimeError",b)});e.send(null,c)}d.call(this);h.extend(this,{uid:h.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){b.apply(this,arguments)},downsize:function(a,b,c,d){var e={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:!1,preserveHeaders:!0,resample:!1};a="object"==typeof a?h.extend(e,a):h.extend(e,{width:a,height:b,crop:c,preserveHeaders:d});try{if(!this.size)throw new f.DOMException(f.DOMException.INVALID_STATE_ERR);if(this.width>k.MAX_RESIZE_WIDTH||this.height>k.MAX_RESIZE_HEIGHT)throw new f.ImageError(f.ImageError.MAX_RESOLUTION_ERR);this.exec("Image","downsize",a.width,a.height,a.crop,a.preserveHeaders)}catch(z){this.trigger("error",z.code)}},crop:function(a,b,c){this.downsize(a,b,!0,c)},getAsCanvas:function(){if(!c.can("create_canvas"))throw new f.RuntimeError(f.RuntimeError.NOT_SUPPORTED_ERR);return this.connectRuntime(this.ruid).exec.call(this,"Image","getAsCanvas")},getAsBlob:function(a,b){if(!this.size)throw new f.DOMException(f.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsBlob",a||"image/jpeg",b||90)},getAsDataURL:function(a,b){if(!this.size)throw new f.DOMException(f.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsDataURL",a||"image/jpeg",b||90)},getAsBinaryString:function(a,b){a=this.getAsDataURL(a,b);return A.atob(a.substring(a.indexOf("base64,")+7))},embed:function(a,b){function d(b,d){var n=this;if(c.can("create_canvas")){var k=n.getAsCanvas();if(k)return a.appendChild(k),k=null,n.destroy(),void e.trigger("embedded")}d=n.getAsDataURL(b,d);if(!d)throw new f.ImageError(f.ImageError.WRONG_FORMAT);c.can("use_data_uri_of",d.length)?(a.innerHTML='\x3cimg src\x3d"'+d+'" width\x3d"'+n.width+'" height\x3d"'+n.height+'" /\x3e',n.destroy(),e.trigger("embedded")):(k=new r,k.bind("TransportingComplete",function(){p=e.connectRuntime(this.result.ruid);e.bind("Embedded",function(){h.extend(p.getShimContainer().style,{top:"0px",left:"0px",width:n.width+"px",height:n.height+"px"});p=null},999);p.exec.call(e,"ImageView","display",this.result.uid,width,height);n.destroy()}),k.transport(A.atob(d.substring(d.indexOf("base64,")+7)),b,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:a}))}var e=this,p;b=h.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90},b||{});try{if(!(a=g.get(a)))throw new f.DOMException(f.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new f.DOMException(f.DOMException.INVALID_STATE_ERR);this.width>k.MAX_RESIZE_WIDTH||this.height>k.MAX_RESIZE_HEIGHT;var n=new k;return n.bind("Resize",function(){d.call(this,b.type,b.quality)}),n.bind("Load",function(){n.downsize(b)}),this.meta.thumb&&this.meta.thumb.width>=b.width&&this.meta.thumb.height>=b.height?n.load(this.meta.thumb.data):n.clone(this,!1),n}catch(B){this.trigger("error",B.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime());this.unbindAll()}});this.handleEventProps(l);this.bind("Load Resize",function(){var a;a=this.exec("Image","getInfo");this.size=a.size;this.width=a.width;this.height=a.height;this.type=a.type;this.meta=a.meta;""===this.name&&(this.name=a.name)},999)}var l=["progress","load","error","resize","embedded"];return k.MAX_RESIZE_WIDTH=8192,k.MAX_RESIZE_HEIGHT=8192,k.prototype=n.instance,k});m("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(h,k,f,b){var a={};return f.addConstructor("html5",function(e,d,k){var c=this,n=f.capTest,g=f.capTrue;k=h.extend({access_binary:n(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return c.can("access_binary")&&!!a.Image},display_media:n(b.can("create_canvas")||b.can("use_data_uri_over32kb")),do_cors:n(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:n(function(){var a=document.createElement("div");return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&("IE"!==b.browser||b.verComp(b.version,9,"\x3e"))}()),filter_by_extension:n("Chrome"===b.browser&&b.verComp(b.version,28,"\x3e\x3d")||"IE"===b.browser&&b.verComp(b.version,10,"\x3e\x3d")||"Safari"===b.browser&&b.verComp(b.version,7,"\x3e\x3d")),return_response_headers:g,return_response_type:function(a){return"json"===a&&window.JSON?!0:b.can("return_response_type",a)},return_status_code:g,report_upload_progress:n(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return c.can("access_binary")&&b.can("create_canvas")},select_file:function(){return b.can("use_fileinput")&&window.File},select_folder:function(){return c.can("select_file")&&"Chrome"===b.browser&&b.verComp(b.version,21,"\x3e\x3d")},select_multiple:function(){return!(!c.can("select_file")||"Safari"===b.browser&&"Windows"===b.os||"iOS"===b.os&&b.verComp(b.osVersion,"7.0.0","\x3e")&&b.verComp(b.osVersion,"8.0.0","\x3c"))},send_binary_string:n(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:n(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||c.can("send_binary_string")},slice_blob:n(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return c.can("slice_blob")&&c.can("send_multipart")},summon_file_dialog:function(){return c.can("select_file")&&("Firefox"===b.browser&&b.verComp(b.version,4,"\x3e\x3d")||"Opera"===b.browser&&b.verComp(b.version,12,"\x3e\x3d")||"IE"===b.browser&&b.verComp(b.version,10,"\x3e\x3d")||!!~h.inArray(b.browser,["Chrome","Safari"]))},upload_filesize:g},k);f.call(this,e,d||"html5",k);h.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(c);a=c=null}}(this.destroy)});h.extend(this.getShim(),a)}),a});m("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(h){function k(){this.returnValue=!1}function f(){this.cancelBubble=!0}var b={},a="moxie_"+h.guid(),e=function(d,e,c){var f;if(e=e.toLowerCase(),d[a]&&b[d[a]]&&b[d[a]][e]){f=b[d[a]][e];for(var k=f.length-
1;0<=k&&(f[k].orig!==c&&f[k].key!==c||(d.removeEventListener?d.removeEventListener(e,f[k].func,!1):d.detachEvent&&d.detachEvent("on"+e,f[k].func),f[k].orig=null,f[k].func=null,f.splice(k,1),void 0===c));k--);if(f.length||delete b[d[a]][e],h.isEmptyObj(b[d[a]])){delete b[d[a]];try{delete d[a]}catch(p){d[a]=void 0}}}};return{addEvent:function(d,e,c,n){var g;e=e.toLowerCase();d.addEventListener?(g=c,d.addEventListener(e,g,!1)):d.attachEvent&&(g=function(){var a=window.event;a.target||(a.target=a.srcElement);a.preventDefault=k;a.stopPropagation=f;c(a)},d.attachEvent("on"+e,g));d[a]||(d[a]=h.guid());b.hasOwnProperty(d[a])||(b[d[a]]={});d=b[d[a]];d.hasOwnProperty(e)||(d[e]=[]);d[e].push({func:g,orig:c,key:n})},removeEvent:e,removeAllEvents:function(d,f){d&&d[a]&&h.each(b[d[a]],function(a,b){e(d,b,f)})}}});m("moxie/runtime/html5/file/FileInput","moxie/runtime/html5/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(h,k,f,b,a,e,d){return h.FileInput=function(){var h;f.extend(this,{init:function(c){var n=this,g=n.getRuntime(),p,r,u;h=c;c=h.accept.mimes||e.extList2mimes(h.accept,g.can("filter_by_extension"));p=g.getShimContainer();p.innerHTML='\x3cinput id\x3d"'+g.uid+'" type\x3d"file" style\x3d"font-size:999px;opacity:0;"'+(h.multiple&&g.can("select_multiple")?"multiple":"")+(h.directory&&g.can("select_folder")?"webkitdirectory directory":"")+(c?' accept\x3d"'+c.join(",")+'"':"")+" /\x3e";c=b.get(g.uid);f.extend(c.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});r=b.get(h.browse_button);g.can("summon_file_dialog")&&("static"===b.getStyle(r,"position")&&(r.style.position="relative"),u=parseInt(b.getStyle(r,"z-index"),10)||1,r.style.zIndex=u,p.style.zIndex=u-1,a.addEvent(r,"click",function(a){var c=b.get(g.uid);c&&!c.disabled&&c.click();a.preventDefault()},n.uid));u=g.can("summon_file_dialog")?r:p;a.addEvent(u,"mouseover",function(){n.trigger("mouseenter")},n.uid);a.addEvent(u,"mouseout",function(){n.trigger("mouseleave")},n.uid);a.addEvent(u,"mousedown",function(){n.trigger("mousedown")},n.uid);a.addEvent(b.get(h.container),"mouseup",function(){n.trigger("mouseup")},n.uid);c.onchange=function N(a){(n.files=[],f.each(this.files,function(a){var b="";return h.directory&&"."==a.name?!0:(a.webkitRelativePath&&(b="/"+a.webkitRelativePath.replace(/^\//,"")),a=new k(g.uid,a),a.relativePath=b,void n.files.push(a))}),"IE"!==d.browser&&"IEMobile"!==d.browser)?this.value="":(a=this.cloneNode(!0),this.parentNode.replaceChild(a,this),a.onchange=N);n.files.length&&n.trigger("change")};n.trigger({type:"ready",async:!0});p=null},disable:function(a){var c=this.getRuntime(),d;(d=b.get(c.uid))&&(d.disabled=!!a)},destroy:function(){var c=this.getRuntime(),d=c.getShim(),c=c.getShimContainer();a.removeAllEvents(c,this.uid);a.removeAllEvents(h&&b.get(h.container),this.uid);a.removeAllEvents(h&&b.get(h.browse_button),this.uid);c&&(c.innerHTML="");d.removeInstance(this.uid);h=null}})}});m("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(h,k){return h.Blob=function(){function f(b,a,e){var d;if(!window.File.prototype.slice)return(d=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?d.call(b,a,e):null;try{return b.slice(),b.slice(a,e)}catch(r){return b.slice(a,e-a)}}this.slice=function(){return new k(this.getRuntime().uid,f.apply(this,arguments))}}});m("moxie/runtime/html5/file/FileDrop","moxie/runtime/html5/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime".split(" "),function(h,k,f,b,a,e){return h.FileDrop=function(){function d(a){if(!a.dataTransfer||!a.dataTransfer.types)return!1;a=f.toArray(a.dataTransfer.types||[]);return-1!==f.inArray("Files",a)||-1!==f.inArray("public.file-url",a)||-1!==f.inArray("application/x-moz-file",a)}function h(a,b){var c;l.length?(c=e.getFileExtension(a.name),c=!c||-1!==f.inArray(c,l)):c=!0;c&&(a=new k(O,a),a.relativePath=b||"",u.push(a))}function c(a){for(var b=[],c=0;c<a.length;c++)[].push.apply(b,a[c].extensions.split(/\s*,\s*/));return-1===f.inArray("*",b)?b:[]}function g(a,b){var c=[];f.each(a,function(a){var b=a.webkitGetAsEntry();b&&(b.isFile?h(a.getAsFile(),b.fullPath):c.push(b))});c.length?t(c,b):b()}function t(a,b){var c=[];f.each(a,function(a){c.push(function(b){p(a,b)})});f.inSeries(c,function(){b()})}function p(a,b){a.isFile?a.file(function(c){h(c,a.fullPath);b()},function(){b()}):a.isDirectory?A(a,b):b()}function A(a,b){function c(a){e.readEntries(function(b){b.length?([].push.apply(d,b),c(a)):a()},a)}var d=[],e=a.createReader();c(function(){t(d,b)})}var u=[],l=[],m,O;f.extend(this,{init:function(b){var e=this;m=b;O=e.ruid;l=c(m.accept);b=m.container;a.addEvent(b,"dragover",function(a){d(a)&&(a.preventDefault(),a.dataTransfer.dropEffect="copy")},e.uid);a.addEvent(b,"drop",function(a){d(a)&&(a.preventDefault(),u=[],a.dataTransfer.items&&a.dataTransfer.items[0].webkitGetAsEntry?g(a.dataTransfer.items,function(){e.files=u;e.trigger("drop")}):(f.each(a.dataTransfer.files,function(a){h(a)}),e.files=u,e.trigger("drop")))},e.uid);a.addEvent(b,"dragenter",function(a){e.trigger("dragenter")},e.uid);a.addEvent(b,"dragleave",function(a){e.trigger("dragleave")},e.uid)},destroy:function(){a.removeAllEvents(m&&b.get(m.container),this.uid);O=u=l=m=null}})}});m("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(h,k,f){return h.FileReader=function(){var b,a=!1;f.extend(this,{read:function(e,d){var h=this;h.result="";b=new window.FileReader;b.addEventListener("progress",function(a){h.trigger(a)});b.addEventListener("load",function(c){var d;a?(d=b.result,d=k.atob(d.substring(d.indexOf("base64,")+7))):d=b.result;h.result=d;h.trigger(c)});b.addEventListener("error",function(a){h.trigger(a,b.error)});b.addEventListener("loadend",function(a){b=null;h.trigger(a)});"function"===f.typeOf(b[e])?(a=!1,b[e](d.getSource())):"readAsBinaryString"===e&&(a=!0,b.readAsDataURL(d.getSource()))},abort:function(){b&&b.abort()},destroy:function(){b=null}})}});m("moxie/runtime/html5/xhr/XMLHttpRequest","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/utils/Mime moxie/core/utils/Url moxie/file/File moxie/file/Blob moxie/xhr/FormData moxie/core/Exceptions moxie/core/utils/Env".split(" "),function(h,k,f,b,a,e,d,g,c){return h.XMLHttpRequest=function(){function h(a,b){var c=this,d,f;d=b.getBlob().getSource();f=new window.FileReader;f.onload=function(){b.append(b.getBlobName(),new e(null,{type:d.type,data:f.result}));A.send.call(c,a,b)};f.readAsBinaryString(d)}function r(){var a;if(!window.XMLHttpRequest||"IE"===c.browser&&c.verComp(c.version,8,"\x3c"))a:{for(var b=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],d=0;d<b.length;d++)try{a=new ActiveXObject(b[d]);break a}catch(G){}a=void 0}else a=new window.XMLHttpRequest;return a}function p(a){var b="----moxieboundary"+(new Date).getTime(),c="";if(!this.getRuntime().can("send_binary_string"))throw new g.RuntimeError(g.RuntimeError.NOT_SUPPORTED_ERR);return u.setRequestHeader("Content-Type","multipart/form-data; boundary\x3d"+b),a.each(function(a,d){c+=a instanceof
e?"--"+b+'\r\nContent-Disposition: form-data; name\x3d"'+d+'"; filename\x3d"'+unescape(encodeURIComponent(a.name||"blob"))+'"\r\nContent-Type: '+(a.type||"application/octet-stream")+"\r\n\r\n"+a.getSource()+"\r\n":"--"+b+'\r\nContent-Disposition: form-data; name\x3d"'+d+'"\r\n\r\n'+unescape(encodeURIComponent(a))+"\r\n"}),c+="--"+b+"--\r\n"}var A=this,u,l;k.extend(this,{send:function(a,f){var g=this,n="Mozilla"===c.browser&&c.verComp(c.version,4,"\x3e\x3d")&&c.verComp(c.version,7,"\x3c"),t="Android Browser"===c.browser,A=!1;if(l=a.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),u=r(),u.open(a.method,a.url,a.async,a.user,a.password),f instanceof e)f.isDetached()&&(A=!0),f=f.getSource();else if(f instanceof d){if(f.hasBlob())if(f.getBlob().isDetached())f=p.call(g,f),A=!0;else if((n||t)&&"blob"===k.typeOf(f.getBlob().getSource())&&window.FileReader)return void h.call(g,a,f);if(f instanceof d){var m=new window.FormData;f.each(function(a,b){a instanceof e?m.append(b,a.getSource()):m.append(b,a)});f=m}}u.upload?(a.withCredentials&&(u.withCredentials=!0),u.addEventListener("load",function(a){g.trigger(a)}),u.addEventListener("error",function(a){g.trigger(a)}),u.addEventListener("progress",function(a){g.trigger(a)}),u.upload.addEventListener("progress",function(a){g.trigger({type:"UploadProgress",loaded:a.loaded,total:a.total})})):u.onreadystatechange=function(){switch(u.readyState){case 3:var c,d;try{b.hasSameOrigin(a.url)&&(c=u.getResponseHeader("Content-Length")||0),u.responseText&&(d=u.responseText.length)}catch(z){c=d=0}g.trigger({type:"progress",lengthComputable:!!c,total:parseInt(c,10),loaded:d});break;case 4:u.onreadystatechange=function(){},g.trigger(0===u.status?"error":"load")}};k.isEmptyObj(a.headers)||k.each(a.headers,function(a,b){u.setRequestHeader(b,a)});""!==a.responseType&&"responseType"in u&&("json"!==a.responseType||c.can("return_response_type","json")?u.responseType=a.responseType:u.responseType="text");A?u.sendAsBinary?u.sendAsBinary(f):!function(){for(var a=new Uint8Array(f.length),b=0;b<f.length;b++)a[b]=255&f.charCodeAt(b);u.send(a.buffer)}():u.send(f);g.trigger("loadstart")},getStatus:function(){try{if(u)return u.status}catch(N){}return 0},getResponse:function(b){var d=this.getRuntime();try{switch(b){case "blob":var e=new a(d.uid,u.response),p=u.getResponseHeader("Content-Disposition");if(p){var h=p.match(/filename=([\'\"'])([^\1]+)\1/);h&&(l=h[2])}return e.name=l,e.type||(e.type=f.getFileMime(l)),e;case "json":return c.can("return_response_type","json")?u.response:200===u.status&&window.JSON?JSON.parse(u.responseText):null;case "document":var g=u.responseXML,k=u.responseText;return"IE"===c.browser&&k&&g&&!g.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(u.getResponseHeader("Content-Type"))&&(g=new window.ActiveXObject("Microsoft.XMLDOM"),g.async=!1,g.validateOnParse=!1,g.loadXML(k)),g&&("IE"===c.browser&&0!==g.parseError||!g.documentElement||"parsererror"===g.documentElement.tagName)?null:g;default:return""!==u.responseText?u.responseText:null}}catch(P){return null}},getAllResponseHeaders:function(){try{return u.getAllResponseHeaders()}catch(N){}return""},abort:function(){u&&u.abort()},destroy:function(){A=l=null}})}});m("moxie/runtime/html5/utils/BinaryReader",["moxie/core/utils/Basic"],function(h){function g(a){a instanceof ArrayBuffer?f.apply(this,arguments):b.apply(this,arguments)}function f(a){var b=new DataView(a);h.extend(this,{readByteAt:function(a){return b.getUint8(a)},writeByteAt:function(a,e){b.setUint8(a,e)},SEGMENT:function(d,e,c){switch(arguments.length){case 2:return a.slice(d,d+e);case 1:return a.slice(d);case 3:if(null===c&&(c=new ArrayBuffer),c instanceof ArrayBuffer){var f=new Uint8Array(this.length()-e+c.byteLength);0<d&&f.set(new Uint8Array(a.slice(0,d)),0);f.set(new Uint8Array(c),d);f.set(new Uint8Array(a.slice(d+e)),d+c.byteLength);this.clear();a=f.buffer;b=new DataView(a);break}default:return a}},length:function(){return a?a.byteLength:0},clear:function(){b=a=null}})}function b(a){function b(b,e,c){c=3===arguments.length?c:a.length-e-1;a=a.substr(0,e)+b+a.substr(c+e)}h.extend(this,{readByteAt:function(b){return a.charCodeAt(b)},writeByteAt:function(a,e){b(String.fromCharCode(e),a,1)},SEGMENT:function(d,e,c){switch(arguments.length){case 1:return a.substr(d);case 2:return a.substr(d,e);case 3:b(null!==c?c:"",d,e);break;default:return a}},length:function(){return a?a.length:0},clear:function(){a=null}})}return h.extend(g.prototype,{littleEndian:!1,read:function(a,b){var d,e,c;if(a+b>this.length())throw Error("You are trying to read outside the source boundaries.");e=this.littleEndian?0:-8*(b-1);for(d=c=0;b>c;c++)d|=this.readByteAt(a+
c)<<Math.abs(e+8*c);return d},write:function(a,b,d){var e,c;if(a>this.length())throw Error("You are trying to write outside the source boundaries.");e=this.littleEndian?0:-8*(d-1);for(c=0;d>c;c++)this.writeByteAt(a+c,b>>Math.abs(e+8*c)&255)},BYTE:function(a){return this.read(a,1)},SHORT:function(a){return this.read(a,2)},LONG:function(a){return this.read(a,4)},SLONG:function(a){a=this.read(a,4);return 2147483647<a?a-4294967296:a},CHAR:function(a){return String.fromCharCode(this.read(a,1))},STRING:function(a,b){return this.asArray("CHAR",a,b).join("")},asArray:function(a,b,d){for(var e=[],c=0;d>c;c++)e[c]=this[a](b+c);return e}}),g});m("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(g,k){return function b(a){var e=[],d,h,c,n=0;if(d=new g(a),65496!==d.SHORT(0))throw d.clear(),new k.ImageError(k.ImageError.WRONG_FORMAT);for(h=2;h<=d.length();)if(c=d.SHORT(h),65488<=c&&65495>=c)h+=2;else{if(65498===c||65497===c)break;n=d.SHORT(h+2)+2;65505<=c&&65519>=c&&e.push({hex:c,name:"APP"+(15&c),start:h,length:n,segment:d.SEGMENT(h,n)});h+=n}return d.clear(),{headers:e,restore:function(a){var b,c,d;d=new g(a);h=65504==d.SHORT(2)?4+d.SHORT(4):2;c=0;for(b=e.length;b>c;c++)d.SEGMENT(h,0,e[c].segment),h+=e[c].length;return a=d.SEGMENT(),d.clear(),a},strip:function(a){var c,d,e;c=new b(a);d=c.headers;c.purge();c=new g(a);for(e=d.length;e--;)c.SEGMENT(d[e].start,d[e].length,"");return a=c.SEGMENT(),c.clear(),a},get:function(a){for(var b=[],c=0,d=e.length;d>c;c++)e[c].name===a.toUpperCase()&&b.push(e[c].segment);return b},set:function(a,b){var c=[],d,h;"string"==typeof b?c.push(b):c=b;b=d=0;for(h=e.length;h>b&&(e[b].name===a.toUpperCase()&&(e[b].segment=c[d],e[b].length=c[d].length,d++),!(d>=c.length));b++);},purge:function(){this.headers=e=[]}}}});m("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(h,k,f){function b(a){function e(a,b){var d,e,p,k,t,A,r,u,l,m={},q={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},B={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};d=this.SHORT(a);for(e=0;d>e;e++)if(l=[],r=a+2+12*e,p=b[this.SHORT(r)],p!==g){if(k=q[this.SHORT(r+=2)],t=this.LONG(r+=2),A=B[k],!A)throw new f.ImageError(f.ImageError.INVALID_META_ERR);if(r+=4,4<A*t&&(r=this.LONG(r)+n.tiffHeader),r+A*t>=this.length())throw new f.ImageError(f.ImageError.INVALID_META_ERR);"ASCII"!==k?(l=this.asArray(k,r,t),u=1==t?l[0]:l,c.hasOwnProperty(p)&&"object"!=typeof u?m[p]=c[p][u]:m[p]=u):m[p]=h.trim(this.STRING(r,t).replace(/\0$/,""))}return m}var d,r,c,n,t,p;if(k.call(this,a),r={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}},c={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},n={tiffHeader:10},t=n.tiffHeader,d={clear:this.clear},h.extend(this,{read:function(){try{return b.prototype.read.apply(this,arguments)}catch(A){throw new f.ImageError(f.ImageError.INVALID_META_ERR);}},write:function(){try{return b.prototype.write.apply(this,arguments)}catch(A){throw new f.ImageError(f.ImageError.INVALID_META_ERR);}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(a){return this.LONG(a)/this.LONG(a+4)},SRATIONAL:function(a){return this.SLONG(a)/this.SLONG(a+4)},ASCII:function(a){return this.CHAR(a)},TIFF:function(){return p||null},EXIF:function(){var a=null;if(n.exifIFD){try{a=e.call(this,n.exifIFD,r.exif)}catch(N){return null}if(a.ExifVersion&&"array"===h.typeOf(a.ExifVersion)){for(var b=0,c="";b<a.ExifVersion.length;b++)c+=String.fromCharCode(a.ExifVersion[b]);a.ExifVersion=c}}return a},GPS:function(){var a=null;if(n.gpsIFD){try{a=e.call(this,n.gpsIFD,r.gps)}catch(u){return null}a.GPSVersionID&&"array"===h.typeOf(a.GPSVersionID)&&(a.GPSVersionID=a.GPSVersionID.join("."))}return a},thumb:function(){if(n.IFD1)try{var a=e.call(this,n.IFD1,r.thumb);if("JPEGInterchangeFormat"in a)return this.SEGMENT(n.tiffHeader+a.JPEGInterchangeFormat,a.JPEGInterchangeFormatLength)}catch(u){}return null},setExif:function(a,b){if("PixelXDimension"!==a&&"PixelYDimension"!==a)b=!1;else a:{var c,d,e,f=0;if("string"==typeof a)for(c in d=r.exif,d)if(d[c]===a){a=c;break}c=n.exifIFD;d=this.SHORT(c);for(var h=0;d>h;h++)if(e=c+12*h+2,this.SHORT(e)==a){f=e+8;break}if(f){try{this.write(f,b,4)}catch(D){b=!1;break a}b=!0}else b=!1}return b},clear:function(){d.clear();a=r=c=p=n=d=null}}),65505!==this.SHORT(0)||"EXIF\x00"!==this.STRING(4,5).toUpperCase())throw new f.ImageError(f.ImageError.INVALID_META_ERR);if(this.littleEndian=18761==this.SHORT(t),42!==this.SHORT(t+=2))throw new f.ImageError(f.ImageError.INVALID_META_ERR);n.IFD0=n.tiffHeader+this.LONG(t+=2);p=e.call(this,n.IFD0,r.tiff);"ExifIFDPointer"in p&&(n.exifIFD=n.tiffHeader+p.ExifIFDPointer,delete p.ExifIFDPointer);"GPSInfoIFDPointer"in
p&&(n.gpsIFD=n.tiffHeader+p.GPSInfoIFDPointer,delete p.GPSInfoIFDPointer);h.isEmptyObj(p)&&(p=null);(t=this.LONG(n.IFD0+12*this.SHORT(n.IFD0)+2))&&(n.IFD1=n.tiffHeader+t)}return b.prototype=k.prototype,b});m("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(h,g,f,b,a){return function(e){function d(a){var b=0,d,e;for(a||(a=c);b<=a.length();){if(d=a.SHORT(b+=2),65472<=d&&65475>=d)return b+=5,{height:a.SHORT(b),width:a.SHORT(b+2)};e=a.SHORT(b+=2);b+=e-2}return null}function k(){var a=t.thumb(),c,e;return a&&(c=new b(a),e=d(c),c.clear(),e)?(e.data=a,e):null}var c,n,t,p;if(c=new b(e),65496!==c.SHORT(0))throw new g.ImageError(g.ImageError.WRONG_FORMAT);n=new f(e);try{t=new a(n.get("app1")[0])}catch(A){}p=d.call(this);h.extend(this,{type:"image/jpeg",size:c.length(),width:p&&p.width||0,height:p&&p.height||0,setExif:function(a,b){return t?("object"===h.typeOf(a)?h.each(a,function(a,b){t.setExif(b,a)}):t.setExif(a,b),void n.set("app1",t.SEGMENT())):!1},writeHeaders:function(){return n.restore(arguments.length?arguments[0]:e)},stripHeaders:function(a){return n.strip(a)},purge:function(){t&&n&&c&&(t.clear(),n.purge(),c.clear(),p=n=t=c=null)}});t&&(this.meta={tiff:t.TIFF(),exif:t.EXIF(),gps:t.GPS(),thumb:k()})}});m("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(h,g,f){return function(b){function a(){e&&(e.clear(),b=d=e=null)}var e,d;e=new f(b);(function(){var a=0,b,d=[35152,20039,3338,6666];for(b=0;b<d.length;b++,a+=2)if(d[b]!=e.SHORT(a))throw new h.ImageError(h.ImageError.WRONG_FORMAT);})();d=function(){var a,b,d=8,f,h,g,k;return a=(f=e.LONG(d),h=e.STRING(d+=4,4),g=d+=4,k=e.LONG(d+f),{length:f,type:h,start:g,CRC:k}),"IHDR"==a.type?(b=a.start,{width:e.LONG(b),height:e.LONG(b+4)}):null}.call(this);g.extend(this,{type:"image/png",size:e.length(),width:d.width,height:d.height,purge:function(){a.call(this)}});a.call(this)}});m("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(h,g,f,b){return function(a){var e=[f,b],d;d=function(){for(var b=0;b<e.length;b++)try{return new e[b](a)}catch(c){}throw new g.ImageError(g.ImageError.WRONG_FORMAT);}();h.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(a){return a},stripHeaders:function(a){return a},purge:function(){a=null}});h.extend(this,d);this.purge=function(){d.purge();d=null}}});m("moxie/runtime/html5/image/MegaPixel",[],function(){function h(h){var f=h.naturalWidth;if(1048576<f*h.naturalHeight){var b=document.createElement("canvas");b.width=b.height=1;b=b.getContext("2d");return b.drawImage(h,-f+1,0),0===b.getImageData(0,0,1,1).data[3]}return!1}return{isSubsampled:h,renderTo:function(g,f,b){var a=g.naturalWidth,e=g.naturalHeight,d=b.width,k=b.height,c=b.x||0;b=b.y||0;f=f.getContext("2d");h(g)&&(a/=2,e/=2);var n=document.createElement("canvas");n.width=n.height=1024;var t=n.getContext("2d"),p;p=e;var l=document.createElement("canvas");l.width=1;l.height=p;l=l.getContext("2d");l.drawImage(g,0,0);for(var l=l.getImageData(0,0,1,p).data,u=0,m=p,q=p;q>u;)0===l[4*(q-1)+3]?m=q:u=q,q=m+u>>1;p=q/p;p=0===p?1:p;for(l=0;e>l;){u=l+1024>e?e-l:1024;for(m=0;a>m;)q=m+1024>a?a-m:1024,t.clearRect(0,0,1024,1024),t.drawImage(g,-m,-l),f.drawImage(n,0,0,q,u,m*d/a+c<<0,l*k/e/p+b<<0,Math.ceil(q*d/a),Math.ceil(u*k/e/p)),m+=1024;l+=1024}}}});m("moxie/runtime/html5/image/Image","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/Exceptions moxie/core/utils/Encode moxie/file/Blob moxie/file/File moxie/runtime/html5/image/ImageInfo moxie/runtime/html5/image/MegaPixel moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(h,g,f,b,a,e,d,l,c,n){return h.Image=function(){function h(){if(!D&&!v)throw new f.ImageError(f.DOMException.INVALID_STATE_ERR);return D||v}function p(a){return b.atob(a.substring(a.indexOf("base64,")+7))}function k(a){var c=this;v=new Image;v.onerror=function(){q.call(this);c.trigger("error",f.ImageError.WRONG_FORMAT)};v.onload=function(){c.trigger("load")};v.src="data:"==a.substr(0,5)?a:"data:"+(L.type||"")+";base64,"+b.btoa(a)}function r(a,b){var c=this,d;return window.FileReader?(d=new FileReader,d.onload=function(){b(this.result)},d.onerror=function(){c.trigger("error",f.ImageError.WRONG_FORMAT)},d.readAsDataURL(a),void 0):b(a.getAsDataURL())}function m(a,b,c,d){var e,f=0,p=0,k,t;if(y=d,t=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==g.inArray(t,[5,6,7,8]))b=a=b;k=h();c?(a=Math.min(a,k.width),b=Math.min(b,k.height),e=Math.max(a/k.width,b/k.height)):e=Math.min(a/k.width,b/k.height);if(1<e&&!c&&d)k=void this.trigger("Resize");else{D||(D=document.createElement("canvas"));d=Math.round(k.width*e);e=Math.round(k.height*e);c?(D.width=a,D.height=b,d>a&&(f=Math.round((d-a)/2)),e>b&&(p=Math.round((e-b)/2))):(D.width=d,D.height=e);if(!y){a=D.width;b=D.height;switch(t){case 5:case 6:case 7:case 8:D.width=b;D.height=a;break;default:D.width=a,D.height=b}c=D.getContext("2d");switch(t){case 2:c.translate(a,0);c.scale(-1,1);break;case 3:c.translate(a,b);c.rotate(Math.PI);break;case 4:c.translate(0,b);c.scale(1,-1);break;case 5:c.rotate(.5*Math.PI);c.scale(1,-1);break;case 6:c.rotate(.5*Math.PI);c.translate(0,-b);break;case 7:c.rotate(.5*Math.PI);c.translate(a,-b);c.scale(-1,1);break;case 8:c.rotate(-.5*Math.PI),c.translate(-a,0)}}t=D;f=-f;p=-p;"iOS"===n.OS?l.renderTo(k,t,{width:d,height:e,x:f,y:p}):t.getContext("2d").drawImage(k,f,p,d,e);k=(this.width=D.width,this.height=D.height,P=!0,void this.trigger("Resize"))}return k}function q(){G&&(G.purge(),G=null);H=v=D=L=null;P=!1}var O=this,v,G,D,H,L,P=!1,y=!0;g.extend(this,{loadFromBlob:function(a){var b=this,c=b.getRuntime(),d=1<arguments.length?arguments[1]:!0;if(!c.can("access_binary"))throw new f.RuntimeError(f.RuntimeError.NOT_SUPPORTED_ERR);return L=a,a.isDetached()?(H=a.getSource(),void k.call(this,H)):void r.call(this,a.getSource(),function(a){d&&(H=p(a));k.call(b,a)})},loadFromImage:function(a,b){this.meta=a.meta;L=new e(null,{name:a.name,size:a.size,type:a.type});k.call(this,b?H=a.getAsBinaryString():a.getAsDataURL())},getInfo:function(){var b=this.getRuntime(),e;return!G&&H&&b.can("access_image_binary")&&(G=new d(H)),e={width:h().width||0,height:h().height||0,type:L.type||c.getFileMime(L.name),size:H&&H.length||L.size||0,name:L.name||"",meta:G&&G.meta||this.meta||{}},!e.meta||!e.meta.thumb||e.meta.thumb.data instanceof a||(e.meta.thumb.data=new a(null,{type:"image/jpeg",data:e.meta.thumb.data})),e},downsize:function(){m.apply(this,arguments)},getAsCanvas:function(){return D&&(D.id=this.uid+"_canvas"),D},getAsBlob:function(a,b){return a!==this.type&&m.call(this,this.width,this.height,!1),new e(null,{name:L.name||"",type:a,data:O.getAsBinaryString.call(this,a,b)})},getAsDataURL:function(a,b){b=b||90;if(!P)return v.src;if("image/jpeg"!==a)return D.toDataURL("image/png");try{return D.toDataURL("image/jpeg",b/100)}catch(C){return D.toDataURL("image/jpeg")}},getAsBinaryString:function(a,b){if(!P)return H||(H=p(O.getAsDataURL(a,b))),H;if("image/jpeg"!==a)H=p(O.getAsDataURL(a,b));else{var c;b||(b=90);try{c=D.toDataURL("image/jpeg",b/100)}catch(I){c=D.toDataURL("image/jpeg")}H=p(c);G&&(H=G.stripHeaders(H),y&&(G.meta&&G.meta.exif&&G.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),H=G.writeHeaders(H)),G.purge(),G=null)}return P=!1,H},destroy:function(){O=null;q.call(this);this.getRuntime().getShim().removeInstance(this.uid)}})}});m("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(h,g,f,b,a){function e(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(n){try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(t){a="0.0"}}return a=a.match(/\d+/g),parseFloat(a[0]+"."+a[1])}function d(a){var b=f.get(a);b&&"OBJECT"==b.nodeName&&("IE"===g.browser?(b.style.display="none",function p(){if(4==b.readyState){var c=f.get(a);if(c){for(var d in c)"function"==typeof c[d]&&(c[d]=null);c.parentNode.removeChild(c)}}else setTimeout(p,10)}()):b.parentNode.removeChild(b))}var k={};return a.addConstructor("flash",function(c){var n=this,t;c=h.extend({swf_url:g.swf_url},c);a.call(this,c,"flash",{access_binary:function(a){return a&&"browser"===n.mode},access_image_binary:function(a){return a&&"browser"===n.mode},display_media:a.capTrue,do_cors:a.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===n.mode},resize_image:a.capTrue,return_response_headers:!1,return_response_type:function(a){return"json"===a&&window.JSON?!0:!h.arrayDiff(a,["","text","document"])||"browser"===n.mode},return_status_code:function(a){return"browser"===n.mode||!h.arrayDiff(a,[200,404])},select_file:a.capTrue,select_multiple:a.capTrue,send_binary_string:function(a){return a&&"browser"===n.mode},send_browser_cookies:function(a){return a&&"browser"===n.mode},send_custom_headers:function(a){return a&&"browser"===n.mode},send_multipart:a.capTrue,slice_blob:function(a){return a&&"browser"===n.mode},stream_upload:function(a){return a&&"browser"===n.mode},summon_file_dialog:!1,upload_filesize:function(a){return 2097152>=h.parseSizeStr(a)||"client"===n.mode},use_http_method:function(a){return!h.arrayDiff(a,["GET","POST"])}},{access_binary:function(a){return a?"browser":"client"},access_image_binary:function(a){return a?"browser":"client"},report_upload_progress:function(a){return a?"browser":"client"},return_response_type:function(a){return h.arrayDiff(a,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(a){return h.arrayDiff(a,[200,404])?"browser":["client","browser"]},send_binary_string:function(a){return a?"browser":"client"},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"browser":"client"},stream_upload:function(a){return a?"client":"browser"},upload_filesize:function(a){return 2097152<=h.parseSizeStr(a)?"client":"browser"}},"client");10>e()&&(this.mode=!1);h.extend(this,{getShim:function(){return f.get(this.uid)},shimExec:function(a,b){var c=[].slice.call(arguments,2);return n.getShim().exec(this.uid,a,b,c)},init:function(){var a,d,e;e=this.getShimContainer();h.extend(e.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});a='\x3cobject id\x3d"'+this.uid+'" type\x3d"application/x-shockwave-flash" data\x3d"'+
c.swf_url+'" ';"IE"===g.browser&&(a+='classid\x3d"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');a+='width\x3d"100%" height\x3d"100%" style\x3d"outline:0"\x3e\x3cparam name\x3d"movie" value\x3d"'+c.swf_url+'" /\x3e\x3cparam name\x3d"flashvars" value\x3d"uid\x3d'+escape(this.uid)+"\x26target\x3d"+g.global_event_dispatcher+'" /\x3e\x3cparam name\x3d"wmode" value\x3d"transparent" /\x3e\x3cparam name\x3d"allowscriptaccess" value\x3d"always" /\x3e\x3c/object\x3e';"IE"===g.browser?(d=document.createElement("div"),e.appendChild(d),d.outerHTML=a,d=e=null):e.innerHTML=a;t=setTimeout(function(){n&&!n.initialized&&n.trigger("Error",new b.RuntimeError(b.RuntimeError.NOT_INIT_ERR))},5E3)},destroy:function(a){return function(){d(n.uid);a.call(n);clearTimeout(t);c=t=a=n=null}}(this.destroy)},k)}),k});m("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime","moxie/file/File","moxie/core/utils/Basic"],function(g,k,f){return g.FileInput={init:function(b){var a=this,e=this.getRuntime();this.bind("Change",function(){var b=e.shimExec.call(a,"FileInput","getFiles");a.files=[];f.each(b,function(b){a.files.push(new k(e.uid,b))})},999);this.getRuntime().shimExec.call(this,"FileInput","init",{name:b.name,accept:b.accept,multiple:b.multiple});this.trigger("ready")}}});m("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(g,k){return g.Blob={slice:function(f,b,a,e){var d=this.getRuntime();return 0>b?b=Math.max(f.size+b,0):0<b&&(b=Math.min(b,f.size)),0>a?a=Math.max(f.size+
a,0):0<a&&(a=Math.min(a,f.size)),f=d.shimExec.call(this,"Blob","slice",b,a,e||""),f&&(f=new k(d.uid,f)),f}}});m("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(g,k){function f(b,a){switch(a){case "readAsText":return k.atob(b,"utf8");case "readAsBinaryString":return k.atob(b);case "readAsDataURL":return b}return null}return g.FileReader={read:function(b,a){var e=this;return e.result="","readAsDataURL"===b&&(e.result="data:"+(a.type||"")+";base64,"),e.bind("Progress",function(a,g){g&&(e.result+=f(g,b))},999),e.getRuntime().shimExec.call(this,"FileReader","readAsBase64",a.uid)}}});m("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(g,k){function f(b,a){switch(a){case "readAsText":return k.atob(b,"utf8");case "readAsBinaryString":return k.atob(b);case "readAsDataURL":return b}return null}return g.FileReaderSync={read:function(b,a){var e;return(e=this.getRuntime().shimExec.call(this,"FileReaderSync","readAsBase64",a.uid))?("readAsDataURL"===b&&(e="data:"+(a.type||"")+";base64,"+e),f(e,b,a.type)):null}}});m("moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/flash/Runtime moxie/core/utils/Basic moxie/file/Blob moxie/file/File moxie/file/FileReaderSync moxie/xhr/FormData moxie/runtime/Transporter".split(" "),function(g,k,f,b,a,e,d){return g.XMLHttpRequest={send:function(a,b){function c(){a.transport=m.mode;m.shimExec.call(l,"XMLHttpRequest","send",a,b)}function g(a,d){m.shimExec.call(l,"XMLHttpRequest","appendBlob",a,d.uid);b=null;c()}function h(a,b){var c=new d;c.bind("TransportingComplete",function(){b(this.result)});c.transport(a.getSource(),a.type,{ruid:m.uid})}var l=this,m=l.getRuntime();if(k.isEmptyObj(a.headers)||k.each(a.headers,function(a,b){m.shimExec.call(l,"XMLHttpRequest","setRequestHeader",b,a.toString())}),b instanceof e){var r;if(b.each(function(a,b){a instanceof f?r=b:m.shimExec.call(l,"XMLHttpRequest","append",b,a)}),b.hasBlob()){var q=b.getBlob();q.isDetached()?h(q,function(a){q.destroy();g(r,a)}):g(r,q)}else b=null,c()}else b instanceof f?b.isDetached()?h(b,function(a){b.destroy();b=a.uid;c()}):(b=b.uid,c()):c()},getResponse:function(d){var c,e,f=this.getRuntime();if(e=f.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(e=new b(f.uid,e),"blob"===d)return e;try{if(c=new a,~k.inArray(d,["","text"]))return c.readAsText(e);if("json"===d&&window.JSON)return JSON.parse(c.readAsText(e))}finally{e.destroy()}}return null},abort:function(a){this.getRuntime().shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}}});m("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(g,k){return g.Transporter={getAsBlob:function(f){var b=this.getRuntime();return(f=b.shimExec.call(this,"Transporter","getAsBlob",f))?new k(b.uid,f):null}}});m("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(g,k,f,b,a){return g.Image={loadFromBlob:function(a){function b(a){c.shimExec.call(e,"Image","loadFromBlob",a.uid);e=c=null}var e=this,c=e.getRuntime();if(a.isDetached()){var g=new f;g.bind("TransportingComplete",function(){b(g.result.getSource())});g.transport(a.getSource(),a.type,{ruid:c.uid})}else b(a.getSource())},loadFromImage:function(a){return this.getRuntime().shimExec.call(this,"Image","loadFromImage",a.uid)},getInfo:function(){var a=this.getRuntime(),d=a.shimExec.call(this,"Image","getInfo");return!d.meta||!d.meta.thumb||d.meta.thumb.data instanceof b||(d.meta.thumb.data=new b(a.uid,d.meta.thumb.data)),d},getAsBlob:function(a,d){var e=this.getRuntime();return(a=e.shimExec.call(this,"Image","getAsBlob",a,d))?new b(e.uid,a):null},getAsDataURL:function(){var b=this.getRuntime().Image.getAsBlob.apply(this,arguments),d;return b?(d=new a,d.readAsDataURL(b)):null}}});m("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(g,k,f,b,a){function e(a){var b=!1,d=null,e,f,g,h,k,l=0;try{try{d=new ActiveXObject("AgControl.AgControl"),d.IsVersionSupported(a)&&(b=!0)}catch(U){var m=navigator.plugins["Silverlight Plug-In"];if(m){e=m.description;"1.0.30226.2"===e&&(e="2.0.30226.2");for(f=e.split(".");3<f.length;)f.pop();for(;4>f.length;)f.push(0);for(g=a.split(".");4<g.length;)g.pop();do h=parseInt(g[l],10),k=parseInt(f[l],10),l++;while(l<g.length&&h===k);k>=h&&!isNaN(h)&&(b=!0)}}}catch(U){b=!1}return b}var d={};return a.addConstructor("silverlight",function(h){var c=this,n;h=g.extend({xap_url:k.xap_url},h);a.call(this,h,"silverlight",{access_binary:a.capTrue,access_image_binary:a.capTrue,display_media:a.capTrue,do_cors:a.capTrue,drag_and_drop:!1,report_upload_progress:a.capTrue,resize_image:a.capTrue,return_response_headers:function(a){return a&&"client"===c.mode},return_response_type:function(a){return"json"!==a?!0:!!window.JSON},return_status_code:function(a){return"client"===c.mode||!g.arrayDiff(a,[200,404])},select_file:a.capTrue,select_multiple:a.capTrue,send_binary_string:a.capTrue,send_browser_cookies:function(a){return a&&"browser"===c.mode},send_custom_headers:function(a){return a&&"client"===c.mode},send_multipart:a.capTrue,slice_blob:a.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:a.capTrue,use_http_method:function(a){return"client"===c.mode||!g.arrayDiff(a,["GET","POST"])}},{return_response_headers:function(a){return a?"client":"browser"},return_status_code:function(a){return g.arrayDiff(a,[200,404])?"client":["client","browser"]},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"client":"browser"},use_http_method:function(a){return g.arrayDiff(a,["GET","POST"])?"client":["client","browser"]}});e("2.0.31005.0")&&"Opera"!==k.browser||(this.mode=!1);g.extend(this,{getShim:function(){return f.get(this.uid).content.Moxie},shimExec:function(a,b){var d=[].slice.call(arguments,2);return c.getShim().exec(this.uid,a,b,d)},init:function(){this.getShimContainer().innerHTML='\x3cobject id\x3d"'+this.uid+'" data\x3d"data:application/x-silverlight," type\x3d"application/x-silverlight-2" width\x3d"100%" height\x3d"100%" style\x3d"outline:none;"\x3e\x3cparam name\x3d"source" value\x3d"'+h.xap_url+'"/\x3e\x3cparam name\x3d"background" value\x3d"Transparent"/\x3e\x3cparam name\x3d"windowless" value\x3d"true"/\x3e\x3cparam name\x3d"enablehtmlaccess" value\x3d"true"/\x3e\x3cparam name\x3d"initParams" value\x3d"uid\x3d'+this.uid+",target\x3d"+k.global_event_dispatcher+'"/\x3e\x3c/object\x3e';n=setTimeout(function(){c&&!c.initialized&&c.trigger("Error",new b.RuntimeError(b.RuntimeError.NOT_INIT_ERR))},"Windows"!==k.OS?1E4:5E3)},destroy:function(a){return function(){a.call(c);clearTimeout(n);h=n=a=c=null}}(this.destroy)},d)}),d});m("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime","moxie/file/File","moxie/core/utils/Basic"],function(g,k,f){return g.FileInput={init:function(b){var a=this,e=this.getRuntime();this.bind("Change",function(){var b=e.shimExec.call(a,"FileInput","getFiles");a.files=[];f.each(b,function(b){a.files.push(new k(e.uid,b))})},999);this.getRuntime().shimExec.call(this,"FileInput","init",function(a){for(var b="",c=0;c<a.length;c++)b+=(""!==b?"|":"")+a[c].title+" | *."+a[c].extensions.replace(/,/g,";*.");return b}(b.accept),b.name,b.multiple);this.trigger("ready")}}});m("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(g,k,f){return g.Blob=k.extend({},f)});m("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(g,k,f){return g.FileDrop={init:function(){var b=this.getRuntime(),a;return a=b.getShimContainer(),f.addEvent(a,"dragover",function(a){a.preventDefault();a.stopPropagation();a.dataTransfer.dropEffect="copy"},this.uid),f.addEvent(a,"dragenter",function(a){a.preventDefault();k.get(b.uid).dragEnter(a)&&a.stopPropagation()},this.uid),f.addEvent(a,"drop",function(a){a.preventDefault();k.get(b.uid).dragDrop(a)&&a.stopPropagation()},this.uid),b.shimExec.call(this,"FileDrop","init")}}});m("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(g,k,f){return g.FileReader=k.extend({},f)});m("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(g,k,f){return g.FileReaderSync=k.extend({},f)});m("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(g,k,f){return g.XMLHttpRequest=k.extend({},f)});m("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(g,k,f){return g.Transporter=k.extend({},f)});m("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/runtime/flash/image/Image"],function(g,k,f,b){return g.Image=k.extend({},b,{getInfo:function(){var a=this.getRuntime(),b=["tiff","exif","gps","thumb"],d={meta:{}},g=a.shimExec.call(this,"Image","getInfo");return g.meta&&(k.each(b,function(a){var b=g.meta[a],c,e,f,h;if(b&&b.keys)for(d.meta[a]={},e=0,f=b.keys.length;f>e;e++)c=b.keys[e],(h=b[c])&&(/^(\d|[1-9]\d+)$/.test(h)?h=parseInt(h,10):/^\d*\.\d+$/.test(h)&&(h=parseFloat(h)),d.meta[a][c]=h)}),!d.meta||!d.meta.thumb||d.meta.thumb.data instanceof f||(d.meta.thumb.data=new f(a.uid,d.meta.thumb.data))),d.width=parseInt(g.width,10),d.height=parseInt(g.height,10),d.size=parseInt(g.size,10),d.type=g.type,d.name=g.name,d}})});m("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(g,k,f,b){var a={};return f.addConstructor("html4",function(e){var d=this,h=f.capTest,c=f.capTrue;f.call(this,e,"html4",{access_binary:h(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:h(a.Image&&(b.can("create_canvas")||b.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:h("Chrome"===b.browser&&b.verComp(b.version,28,"\x3e\x3d")||"IE"===b.browser&&b.verComp(b.version,10,"\x3e\x3d")||"Safari"===b.browser&&b.verComp(b.version,7,"\x3e\x3d")),resize_image:function(){return a.Image&&d.can("access_binary")&&b.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(a){return"json"===a&&window.JSON?!0:!!~g.inArray(a,["text","document",""])},return_status_code:function(a){return!g.arrayDiff(a,[200,404])},select_file:function(){return b.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return d.can("select_file")},summon_file_dialog:function(){return d.can("select_file")&&("Firefox"===b.browser&&b.verComp(b.version,4,"\x3e\x3d")||"Opera"===b.browser&&b.verComp(b.version,12,"\x3e\x3d")||"IE"===b.browser&&b.verComp(b.version,10,"\x3e\x3d")||!!~g.inArray(b.browser,["Chrome","Safari"]))},upload_filesize:c,use_http_method:function(a){return!g.arrayDiff(a,["GET","POST"])}});g.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(d);a=d=null}}(this.destroy)});g.extend(this.getShim(),a)}),a});m("moxie/runtime/html4/file/FileInput","moxie/runtime/html4/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(g,k,f,b,a,e,d){return g.FileInput=function(){function g(){var e=this,n=e.getRuntime(),m,t,r,q,v,G;G=f.guid("uid_");m=n.getShimContainer();c&&(r=b.get(c+"_form"),r&&f.extend(r.style,{top:"100%"}));q=document.createElement("form");q.setAttribute("id",G+"_form");q.setAttribute("method","post");q.setAttribute("enctype","multipart/form-data");q.setAttribute("encoding","multipart/form-data");f.extend(q.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});v=document.createElement("input");v.setAttribute("id",G);v.setAttribute("type","file");v.setAttribute("name",l.name||"Filedata");v.setAttribute("accept",h.join(","));f.extend(v.style,{fontSize:"999px",opacity:0});q.appendChild(v);m.appendChild(q);f.extend(v.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});"IE"===d.browser&&d.verComp(d.version,10,"\x3c")&&f.extend(v.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity\x3d0)"});v.onchange=function(){var a;if(this.value){if(this.files){if(a=this.files[0],0===a.size)return void q.parentNode.removeChild(q)}else a={name:this.value};a=new k(n.uid,a);this.onchange=function(){};g.call(e);e.files=[a];v.setAttribute("id",a.uid);q.setAttribute("id",a.uid+"_form");e.trigger("change");v=q=null}};n.can("summon_file_dialog")&&(t=b.get(l.browse_button),a.removeEvent(t,"click",e.uid),a.addEvent(t,"click",function(a){v&&!v.disabled&&v.click();a.preventDefault()},e.uid));c=G;m=r=t=null}var c,h=[],l;f.extend(this,{init:function(c){var d=this,f=d.getRuntime(),k;l=c;h=c.accept.mimes||e.extList2mimes(c.accept,f.can("filter_by_extension"));k=f.getShimContainer();(function(){var e,g;e=b.get(c.browse_button);f.can("summon_file_dialog")&&("static"===b.getStyle(e,"position")&&(e.style.position="relative"),g=parseInt(b.getStyle(e,"z-index"),10)||1,e.style.zIndex=g,k.style.zIndex=g-1);e=f.can("summon_file_dialog")?e:k;a.addEvent(e,"mouseover",function(){d.trigger("mouseenter")},d.uid);a.addEvent(e,"mouseout",function(){d.trigger("mouseleave")},d.uid);a.addEvent(e,"mousedown",function(){d.trigger("mousedown")},d.uid);a.addEvent(b.get(c.container),"mouseup",function(){d.trigger("mouseup")},d.uid);e=null})();g.call(this);k=null;d.trigger({type:"ready",async:!0})},disable:function(a){var d;(d=b.get(c))&&(d.disabled=!!a)},destroy:function(){var d=this.getRuntime(),e=d.getShim(),d=d.getShimContainer();a.removeAllEvents(d,this.uid);a.removeAllEvents(l&&b.get(l.container),this.uid);a.removeAllEvents(l&&b.get(l.browse_button),this.uid);d&&(d.innerHTML="");e.removeInstance(this.uid);c=h=l=null}})}});m("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(g,k){return g.FileReader=k});m("moxie/runtime/html4/xhr/XMLHttpRequest","moxie/runtime/html4/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Url moxie/core/Exceptions moxie/core/utils/Events moxie/file/Blob moxie/xhr/FormData".split(" "),function(g,k,f,b,a,e,d,l){return g.XMLHttpRequest=function(){function c(a){var b=this,c,d,g,h=!1;if(p){if(c=p.id.replace(/_iframe$/,""),d=f.get(c+"_form")){c=d.getElementsByTagName("input");for(g=c.length;g--;)switch(c[g].getAttribute("type")){case "hidden":c[g].parentNode.removeChild(c[g]);break;case "file":h=!0}c=[];h||d.parentNode.removeChild(d);d=null}setTimeout(function(){e.removeEvent(p,"load",b.uid);p.parentNode&&p.parentNode.removeChild(p);var c=b.getRuntime().getShimContainer();c.children.length||c.parentNode.removeChild(c);p=null;a()},1)}}var g,h,p;k.extend(this,{send:function(n,m){var t=this,r=t.getRuntime(),q,u,v,A;if(g=h=null,m instanceof l&&m.hasBlob()){if(A=m.getBlob(),q=A.uid,v=f.get(q),u=f.get(q+"_form"),!u)throw new a.DOMException(a.DOMException.NOT_FOUND_ERR);}else q=k.guid("uid_"),u=document.createElement("form"),u.setAttribute("id",q+"_form"),u.setAttribute("method",n.method),u.setAttribute("enctype","multipart/form-data"),u.setAttribute("encoding","multipart/form-data"),r.getShimContainer().appendChild(u);u.setAttribute("target",q+"_iframe");m instanceof l&&m.each(function(a,b){if(a instanceof d)v&&v.setAttribute("name",b);else{var c=document.createElement("input");k.extend(c,{type:"hidden",name:b,value:a});v?u.insertBefore(c,v):u.appendChild(c)}});u.setAttribute("action",n.url);(function(){var a=r.getShimContainer()||document.body,d=document.createElement("div");d.innerHTML='\x3ciframe id\x3d"'+q+'_iframe" name\x3d"'+q+'_iframe" src\x3d"javascript:\x26quot;\x26quot;" style\x3d"display:none"\x3e\x3c/iframe\x3e';p=d.firstChild;a.appendChild(p);e.addEvent(p,"load",function(){var a;try{a=p.contentWindow.document||p.contentDocument||window.frames[p.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(a.title)?g=a.title.replace(/^(\d+).*$/,"$1"):(g=200,h=k.trim(a.body.innerHTML),t.trigger({type:"progress",loaded:h.length,total:h.length}),A&&t.trigger({type:"uploadprogress",loaded:A.size||1025,total:A.size||1025}))}catch(y){if(!b.hasSameOrigin(n.url))return void c.call(t,function(){t.trigger("error")});g=404}c.call(t,function(){t.trigger("load")})},t.uid)})();u.submit();t.trigger("loadstart")},getStatus:function(){return g},getResponse:function(a){if("json"===a&&"string"===k.typeOf(h)&&window.JSON)try{return JSON.parse(h.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(u){return null}return h},abort:function(){var a=this;p&&p.contentWindow&&(p.contentWindow.stop?p.contentWindow.stop():p.contentWindow.document.execCommand?p.contentWindow.document.execCommand("Stop"):p.src="about:blank");c.call(this,function(){a.dispatchEvent("abort")})}})}});m("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(g,k){return g.Image=k});(function(h){for(var k=0;k<h.length;k++){for(var f=l,b=h[k],a=b.split(/[.\/]/),e=0;e<a.length-1;++e)f[a[e]]===g&&(f[a[e]]={}),f=f[a[e]];f[a[a.length-1]]=v[b]}})("moxie/core/utils/Basic moxie/core/utils/Env moxie/core/I18n moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/file/FileInput moxie/core/utils/Encode moxie/file/Blob moxie/file/File moxie/file/FileDrop moxie/file/FileReader moxie/core/utils/Url moxie/runtime/RuntimeTarget moxie/file/FileReaderSync moxie/xhr/FormData moxie/xhr/XMLHttpRequest moxie/runtime/Transporter moxie/image/Image moxie/core/utils/Events".split(" "))}(this);(function(l){var g={},q=l.moxie.core.utils.Basic.inArray;return function v(h){var k,f;for(k in h)f=typeof h[k],"object"!==f||~q(k,["Exceptions","Env","Mime"])?"function"===f&&(g[k]=h[k]):v(h[k])}(l.moxie),g.Env=l.moxie.core.utils.Env,g.Mime=l.moxie.core.utils.Mime,g.Exceptions=l.moxie.core.Exceptions,l.mOxie=g,l.o||(l.o=g),g})(this);(function(l,g,q){function m(a){function e(a,b,d){var c={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};c[a]?f[c[a]]=b:d||(f[a]=b)}var d=a.required_features,f={};if("string"===typeof d)b.each(d.split(/\s*,\s*/),function(a){e(a,!0)});else if("object"===typeof d)b.each(d,function(a,b){e(b,a)});else if(!0===d){0<a.chunk_size&&(f.slice_blob=!0);if(a.resize.enabled||!a.multipart)f.send_binary_string=!0;b.each(a,function(a,b){e(b,!!a,!0)})}return f}var v=l.setTimeout,h={},k,f,b={VERSION:"2.1.8",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:g.mimes,ua:g.ua,typeOf:g.typeOf,extend:g.extend,guid:g.guid,get:function(a){var b=[],d;"array"!==g.typeOf(a)&&(a=[a]);for(var f=a.length;f--;)(d=g.get(a[f]))&&b.push(d);return b.length?b:null},each:g.each,getPos:g.getPos,getSize:g.getSize,xmlEncode:function(a){var b={"\x3c":"lt","\x3e":"gt","\x26":"amp",'"':"quot","'":"#39"},d=/[<>&\"\']/g;return a?(""+a).replace(d,function(a){return b[a]?"\x26"+b[a]+";":a}):a},toArray:g.toArray,inArray:g.inArray,addI18n:g.addI18n,translate:g.translate,isEmptyObj:g.isEmptyObj,hasClass:g.hasClass,addClass:g.addClass,removeClass:g.removeClass,getStyle:g.getStyle,addEvent:g.addEvent,removeEvent:g.removeEvent,removeAllEvents:g.removeAllEvents,cleanName:function(a){var b,d;d=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(b=0;b<d.length;b+=2)a=a.replace(d[b],d[b+1]);a=a.replace(/\s+/g,"_");return a=a.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(a,e){var d="";b.each(e,function(a,b){d+=(d?"\x26":"")+encodeURIComponent(b)+"\x3d"+encodeURIComponent(a)});d&&(a+=(0<a.indexOf("?")?"\x26":"?")+d);return a},formatSize:function(a){function e(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}if(a===q||/\D/.test(a))return b.translate("N/A");var d=Math.pow(1024,4);return a>d?e(a/d,1)+" "+b.translate("tb"):a>(d/=1024)?e(a/d,1)+" "+b.translate("gb"):a>(d/=1024)?e(a/d,1)+" "+b.translate("mb"):1024<a?Math.round(a/1024)+" "+b.translate("kb"):a+" "+b.translate("b")},parseSize:g.parseSizeStr,predictRuntime:function(a,e){var d;d=new b.Uploader(a);a=g.Runtime.thatCan(d.getOption().required_features,e||a.runtimes);d.destroy();return a},addFileFilter:function(a,b){h[a]=b}};b.addFileFilter("mime_types",function(a,e,d){a.length&&!a.regexp.test(e.name)?(this.trigger("Error",{code:b.FILE_EXTENSION_ERROR,message:b.translate("File extension error."),file:e}),d(!1)):d(!0)});b.addFileFilter("max_file_size",function(a,e,d){a=b.parseSize(a);void 0!==e.size&&a&&e.size>a?(this.trigger("Error",{code:b.FILE_SIZE_ERROR,message:b.translate("File size error."),file:e}),d(!1)):d(!0)});b.addFileFilter("prevent_duplicates",function(a,e,d){if(a)for(a=this.files.length;a--;)if(e.name===this.files[a].name&&e.size===this.files[a].size){this.trigger("Error",{code:b.FILE_DUPLICATE_ERROR,message:b.translate("Duplicate file error."),file:e});d(!1);return}d(!0)});b.Uploader=function(a){function e(){var a,d=0,c;if(this.state==b.STARTED){for(c=0;c<z.length;c++)a||z[c].status!=b.QUEUED?d++:(a=z[c],this.trigger("BeforeUpload",a)&&(a.status=b.UPLOADING,this.trigger("UploadFile",a)));d==z.length&&(this.state!==b.STOPPED&&(this.state=b.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",z))}}function d(a){a.percent=0<a.size?Math.ceil(a.loaded/a.size*100):100;l()}function l(){var a,c;F.reset();for(a=0;a<z.length;a++)c=z[a],c.size!==q?(F.size+=c.origSize,F.loaded+=c.loaded*c.origSize/c.size):F.size=q,c.status==b.DONE?F.uploaded++:c.status==b.FAILED?F.failed++:F.queued++;F.size===q?F.percent=0<z.length?Math.ceil(F.uploaded/z.length*100):0:(F.bytesPerSec=Math.ceil(F.loaded/((+new Date-Q||1)/1E3)),F.percent=0<F.size?Math.ceil(F.loaded/F.size*100):0)}function c(){var a=C[0]||I[0];return a?a.getRuntime().uid:!1}function n(a,b){return a.ruid&&(a=g.Runtime.getInfo(a.ruid))?a.can(b):!1}function t(){this.bind("FilesAdded FilesRemoved",function(a){a.trigger("QueueChanged");a.refresh()});this.bind("CancelUpload",G);this.bind("BeforeUpload",R);this.bind("UploadFile",N);this.bind("UploadProgress",O);this.bind("StateChanged",U);this.bind("QueueChanged",l);this.bind("Error",H);this.bind("FileUploaded",D);this.bind("Destroy",L)}function p(a,c){var d=this,e=0,h=[],p={runtime_order:a.runtimes,required_caps:a.required_features,preferred_caps:B,swf_url:a.flash_swf_url,xap_url:a.silverlight_xap_url};b.each(a.runtimes.split(/\s*,\s*/),function(b){a[b]&&(p[b]=a[b])});a.browse_button&&b.each(a.browse_button,function(c){h.push(function(w){var h=new g.FileInput(b.extend({},p,{accept:a.filters.mime_types,name:a.file_data_name,multiple:a.multi_selection,container:a.container,browse_button:c}));h.onready=function(){var a=g.Runtime.getInfo(this.ruid);g.extend(d.features,{chunks:a.can("slice_blob"),multipart:a.can("send_multipart"),multi_selection:a.can("select_multiple")});e++;C.push(this);w()};h.onchange=function(){d.addFile(this.files);k=c;f=this.files[0].name;$(document).trigger("fileChange",{target:c,file:this.files})};h.bind("mouseenter mouseleave mousedown mouseup",function(b){M||(a.browse_button_hover&&("mouseenter"===b.type?g.addClass(c,a.browse_button_hover):"mouseleave"===b.type&&g.removeClass(c,a.browse_button_hover)),a.browse_button_active&&("mousedown"===b.type?g.addClass(c,a.browse_button_active):"mouseup"===b.type&&g.removeClass(c,a.browse_button_active)))});h.bind("mousedown",function(){d.trigger("Browse")});h.bind("error runtimeerror",function(){h=null;w()});h.init()})});a.drop_element&&b.each(a.drop_element,function(a){h.push(function(c){var f=new g.FileDrop(b.extend({},p,{drop_zone:a}));f.onready=function(){var a=g.Runtime.getInfo(this.ruid);d.features.dragdrop=a.can("drag_and_drop");e++;I.push(this);c()};f.ondrop=function(){d.addFile(this.files)};f.bind("error runtimeerror",function(){f=null;c()});f.init()})});g.inSeries(h,function(){"function"===typeof c&&c(e)})}function A(a,b,c){var d=new g.Image;try{d.onload=function(){if(b.width>this.width&&b.height>this.height&&b.quality===q&&b.preserve_headers&&!b.crop)return this.destroy(),c(a);d.downsize(b.width,b.height,b.crop,b.preserve_headers)},d.onresize=function(){c(this.getAsBlob(a.type,b.quality));this.destroy()},d.onerror=function(){c(a)},d.load(a)}catch(J){c(a)}}function u(a,d,e){function f(a,c,d){var e=y[a];switch(a){case "max_file_size":"max_file_size"===a&&(y.max_file_size=y.filters.max_file_size=c);break;case "chunk_size":if(c=b.parseSize(c))y[a]=c,y.send_file_name=!0;break;case "multipart":y[a]=c;c||(y.send_file_name=!0);break;case "unique_names":if(y[a]=c)y.send_file_name=!0;break;case "filters":"array"===b.typeOf(c)&&(c={mime_types:c});d?b.extend(y.filters,c):y.filters=c;c.mime_types&&(y.filters.mime_types.regexp=function(a){var c=[];b.each(a,function(a){b.each(a.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?c.push("\\.*"):c.push("\\."+a.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$\x26")+"]","g"),"\\$\x26"))})});return new RegExp("("+c.join("|")+")$","i")}(y.filters.mime_types));break;case "resize":d?b.extend(y.resize,c,{enabled:!0}):y.resize=c;break;case "prevent_duplicates":y.prevent_duplicates=y.filters.prevent_duplicates=!!c;break;case "browse_button":case "drop_element":c=b.get(c);case "container":case "runtimes":case "multi_selection":case "flash_swf_url":case "silverlight_xap_url":y[a]=c;d||(h=!0);break;default:y[a]=c}d||w.trigger("OptionChanged",a,c,e)}var w=this,h=!1;"object"===typeof a?b.each(a,function(a,b){f(b,a,e)}):f(a,d,e);e?(y.required_features=m(b.extend({},y)),B=m(b.extend({},y,{required_features:!0}))):h&&(w.trigger("Destroy"),p.call(w,y,function(a){a?(w.runtime=g.Runtime.getInfo(c()).type,w.trigger("Init",{runtime:w.runtime}),w.trigger("PostInit")):w.trigger("Error",{code:b.INIT_ERROR,message:b.translate("Init error.")})}))}function R(a,b){if(a.settings.unique_names){a=b.name.match(/\.([^.]+)$/);var c="part";a&&(c=a[1]);b.target_name=b.id+"."+c}}function N(a,c){function d(){0<k--?v(e,1E3):(c.loaded=l,a.trigger("Error",{code:b.HTTP_ERROR,message:b.translate("HTTP Error."),file:c,response:E.responseText,status:E.status,responseHeaders:E.getAllResponseHeaders()}))}function e(){var w,x,J={},n;c.status===b.UPLOADING&&a.state!==b.STOPPED&&(a.settings.send_file_name&&(J.name=c.target_name||c.name),h&&p.chunks&&m.size>h?(n=Math.min(h,m.size-l),w=m.slice(l,l+n)):(n=m.size,w=m),h&&p.chunks&&(a.settings.send_chunk_number?(J.chunk=Math.ceil(l/h),J.chunks=Math.ceil(m.size/h)):(J.offset=l,J.total=m.size)),E=new g.XMLHttpRequest,E.upload&&(E.upload.onprogress=function(b){c.loaded=Math.min(c.size,l+b.loaded);a.trigger("UploadProgress",c)}),E.onload=function(){400<=E.status?d():(k=a.settings.max_retries,n<m.size?(w.destroy(),l+=n,c.loaded=Math.min(l,m.size),a.trigger("ChunkUploaded",c,{offset:c.loaded,total:m.size,response:E.responseText,status:E.status,responseHeaders:E.getAllResponseHeaders()}),"Android Browser"===g.Env.browser&&a.trigger("UploadProgress",c)):c.loaded=c.size,w=x=null,!l||l>=m.size?(c.size!=c.origSize&&(m.destroy(),m=null),a.trigger("UploadProgress",c),c.status=b.DONE,a.trigger("FileUploaded",c,{response:E.responseText,status:E.status,responseHeaders:E.getAllResponseHeaders()})):v(e,1))},E.onerror=function(){d()},E.onloadend=function(){this.destroy();E=null},a.settings.multipart&&p.multipart?(E.open("post",f,!0),b.each(a.settings.headers,function(a,b){E.setRequestHeader(b,a)}),x=new g.FormData,b.each(b.extend(J,a.settings.multipart_params),function(a,b){x.append(b,a)}),x.append(a.settings.file_data_name,w),E.send(x,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:B,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})):(f=b.buildUrl(a.settings.url,b.extend(J,a.settings.multipart_params)),E.open("post",f,!0),E.setRequestHeader("Content-Type","application/octet-stream"),b.each(a.settings.headers,function(a,b){E.setRequestHeader(b,a)}),E.send(w,{runtime_order:a.settings.runtimes,required_caps:a.settings.required_features,preferred_caps:B,swf_url:a.settings.flash_swf_url,xap_url:a.settings.silverlight_xap_url})))}var f=a.settings.url,h=a.settings.chunk_size,k=a.settings.max_retries,p=a.features,l=0,m;c.loaded&&(l=c.loaded=h?h*Math.floor(c.loaded/h):0);m=c.getSource();a.settings.resize.enabled&&n(m,"send_binary_string")&&~g.inArray(m.type,["image/jpeg","image/png"])?A.call(this,m,a.settings.resize,function(a){m=a;c.size=a.size;e()}):e()}function O(a,b){d(b)}function U(a){if(a.state==b.STARTED)Q=+new Date;else if(a.state==b.STOPPED)for(var c=a.files.length-1;0<=c;c--)a.files[c].status==b.UPLOADING&&(a.files[c].status=b.QUEUED,l())}
function G(){E&&E.abort()}function D(a){l();v(function(){e.call(a)},1)}function H(a,c){c.code===b.INIT_ERROR?a.destroy():c.code===b.HTTP_ERROR&&(c.file.status=b.FAILED,d(c.file),a.state==b.STARTED&&(a.trigger("CancelUpload"),v(function(){e.call(a)},1)))}function L(a){a.stop();b.each(z,function(a){a.destroy()});z=[];C.length&&(b.each(C,function(a){a.destroy()}),C=[]);I.length&&(b.each(I,function(a){a.destroy()}),I=[]);B={};M=!1;Q=E=null;F.reset()}var P=b.guid(),y,z=[],B={},C=[],I=[],Q,F,M=!1,E;y={runtimes:g.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0};u.call(this,a,null,!0);F=new b.QueueProgress;b.extend(this,{id:P,uid:P,state:b.STOPPED,features:{},runtime:null,files:z,settings:y,total:F,init:function(){var a=this;"function"==typeof y.preinit?y.preinit(a):b.each(y.preinit,function(b,c){a.bind(c,b)});t.call(this);y.browse_button&&y.url?p.call(this,y,function(d){"function"==typeof y.init?y.init(a):b.each(y.init,function(b,c){a.bind(c,b)});d?(a.runtime=g.Runtime.getInfo(c()).type,a.trigger("Init",{runtime:a.runtime}),a.trigger("PostInit")):a.trigger("Error",{code:b.INIT_ERROR,message:b.translate("Init error.")})}):this.trigger("Error",{code:b.INIT_ERROR,message:b.translate("Init error.")})},setOption:function(a,b){u.call(this,a,b,!this.runtime)},getOption:function(a){return a?y[a]:y},refresh:function(){C.length&&b.each(C,function(a){a.trigger("Refresh")});this.trigger("Refresh")},start:function(){this.state!=b.STARTED&&(this.state=b.STARTED,this.trigger("StateChanged"),e.call(this))},stop:function(){this.state!=b.STOPPED&&(this.state=b.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(a){M=a!==q?a:!0;C.length&&b.each(C,function(a){a.disable(M)});this.trigger("DisableBrowse",M)},getFile:function(a){var b;for(b=z.length-1;0<=b;b--)if(z[b].id===a)return z[b]},addFile:function(a,d,e){function w(a,b){var c=[];g.each(p.settings.filters,function(b,d){h[d]&&c.push(function(c){h[d].call(p,b,a,function(a){c(!a)})})});g.inSeries(c,b)}function J(a){var c=g.typeOf(a);if(a instanceof g.File){if(!a.ruid&&!a.isDetached()){if(!m)return!1;a.ruid=m;a.connectRuntime(m)}J(new b.File(a))}else a instanceof g.Blob?(J(a.getSource()),a.destroy()):a instanceof b.File?(d&&(a.name=d),n.push(function(b){w(a,function(c){c||(z.push(a),l.push(a),p.trigger("FileFiltered",a));v(b,1)})})):-1!==g.inArray(c,["file","blob"])?J(new g.File(null,a)):"node"===c&&"filelist"===g.typeOf(a.files)?g.each(a.files,J):"array"===c&&(d=null,g.each(a,J))}var p=this,n=[],l=[],m,t=e||!1;m=c();J(a);n.length&&g.inSeries(n,function(){l.length&&p.trigger("FilesAdded",l,k,f,t)})},removeFile:function(a){a="string"===typeof a?a:a.id;for(var b=z.length-1;0<=b;b--)if(z[b].id===a)return this.splice(b,1)[0]},splice:function(a,c){a=z.splice(a===q?0:a,c===q?z.length:c);var d=!1;this.state==b.STARTED&&(b.each(a,function(a){if(a.status===b.UPLOADING)return d=!0,!1}),d&&this.stop());this.trigger("FilesRemoved",a);b.each(a,function(a){a.destroy()});d&&this.start();return a},dispatchEvent:function(a){var b,c;a=a.toLowerCase();if(b=this.hasEventListener(a)){b.sort(function(a,b){return b.priority-a.priority});c=[].slice.call(arguments);c.shift();c.unshift(this);for(var d=0;d<b.length;d++)if(!1===b[d].fn.apply(b[d].scope,c))return!1}return!0},bind:function(a,c,d,e){b.Uploader.prototype.bind.call(this,a,c,e,d)},destroy:function(){this.trigger("Destroy");y=F=null;this.unbindAll()}})};b.Uploader.prototype=g.EventTarget.instance;b.File=function(){var a={};return function(e){b.extend(this,{id:b.guid(),name:e.name||e.fileName,type:e.type||"",size:e.size||e.fileSize,origSize:e.size||e.fileSize,loaded:0,percent:0,status:b.QUEUED,lastModifiedDate:e.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var a=this.getSource().getSource();return-1!==g.inArray(g.typeOf(a),["blob","file"])?a:null},getSource:function(){return a[this.id]?a[this.id]:null},destroy:function(){var b=this.getSource();b&&(b.destroy(),delete a[this.id])}});a[this.id]=e}}();b.QueueProgress=function(){var a=this;a.size=0;a.loaded=0;a.uploaded=0;a.failed=0;a.queued=0;a.percent=0;a.bytesPerSec=0;a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}};l.plupload=b})(window,mOxie);function FileProgress(l,g){this.fileProgressID=l.id;this.file=l;this.opacity=100;this.height=0;this.fileProgressWrapper=$("#"+this.fileProgressID);if(this.fileProgressWrapper.length)this.reset();else{var q=this.fileProgressWrapper=$("\x3ctr\x3e\x3c/tr\x3e");q.attr("id",this.fileProgressID).addClass("progressContainer");var m=$("\x3ctd/\x3e");m.addClass("progressName").text(l.name);var v=plupload.formatSize(l.size).toUpperCase();l=$("\x3ctd/\x3e");l.addClass("progressFileSize").text(v);var h=$("\x3ctd/\x3e"),k=$("\x3cdiv/\x3e");k.addClass("info");var f=$("\x3cdiv/\x3e");f.addClass("progress progress-striped");var b=$("\x3cdiv/\x3e");b.addClass("progress-bar progress-bar-info").attr("role","progressbar").attr("aria-valuemax",100).attr("aria-valuenow",0).attr("aria-valuein",0).width("0%");var a=$("\x3cspan class\x3dsr-only /\x3e");a.text(v);v=$("\x3ca href\x3d# /\x3e");v.hide().addClass("progressCancel").text("");b.append(a);f.append(b);k.append(f);k.append(v);f=$('\x3cdiv class\x3d"status text-center"/\x3e');k.append(f);h.append(k);q.append(m);q.append(l);q.append(h);$("#"+g).append(q)}this.height=this.fileProgressWrapper.offset().top;this.setTimer(null)}FileProgress.prototype.setTimer=function(l){this.fileProgressWrapper.FP_TIMER=l};FileProgress.prototype.getTimer=function(l){return this.fileProgressWrapper.FP_TIMER||null};FileProgress.prototype.reset=function(){this.fileProgressWrapper.attr("class","progressContainer");this.fileProgressWrapper.find("td .progress .progress-bar-info").attr("aria-valuenow",0).width("0%").find("span").text("");this.appear()};FileProgress.prototype.setChunkProgess=function(l){l=Math.ceil(this.file.size/l);if(1===l)return!1;for(var g=$('\x3cbutton class\x3d"btn btn-default"\x3e\x3c/button\x3e'),q=$('\x3ctr class\x3d"chunk-status-tr"\x3e\x3ctd colspan\x3d3\x3e\x3c/td\x3e\x3c/tr\x3e'),m=$("\x3cdiv/\x3e"),v=1;v<=l;v++){var h=$('\x3cdiv class\x3d"col-md-2"/\x3e'),k=$('\x3cdiv class\x3d"progress progress-striped"\x3e\x3c/div'),f=$("\x3cdiv/\x3e");f.addClass("progress-bar progress-bar-info text-left").attr("role","progressbar").attr("aria-valuemax",100).attr("aria-valuenow",0).attr("aria-valuein",0).width("0%").attr("id",this.file.id+"_"+v).text("");var b=$("\x3cspan/\x3e");b.addClass("chunk-status").text();k.append(f);k.append(b);h.append(k);m.append(h)}this.fileProgressWrapper.find("td\x3ediv").append(g);q.hide().find("td").append(m);q.insertAfter(this.fileProgressWrapper)};FileProgress.prototype.setProgress=function(l,g,q){this.fileProgressWrapper.attr("class","progressContainer green");var m=this.file,v=m.loaded,h=plupload.formatSize(v).toUpperCase();g=plupload.formatSize(g).toUpperCase();var k=this.fileProgressWrapper.find("td .progress").find(".progress-bar-info");this.fileProgressWrapper.find(".status").text(": "+h+"  "+g+"/s");l=parseInt(l,10);m.status!==plupload.DONE&&100===l&&(l=99);k.attr("aria-valuenow",l).css("width",l+"%");if(q){h=Math.ceil(m.size/q);if(1===h)return!1;l=Math.ceil(v/q);for(var f=0;f<l;f++)k=$("#"+m.id+"_"+f),k.width("100%").removeClass().addClass("alert-success").attr("aria-valuenow",100),g=""+f+"100%",k.next().html(g);k=$("#"+m.id+"_"+l);l<h?v%q?q=(v%q/q*100).toFixed(2):(q=100,k.removeClass().addClass("alert-success")):(h=m.size-q*(h-1),(m.size-v)%h?q=(v%q/h*100).toFixed(2):(q=100,k.removeClass().addClass("alert-success")));k.width(q+"%");k.attr("aria-valuenow",q);g=""+l+""+q+"%";k.next().html(g)}this.appear()};FileProgress.prototype.setComplete=function(l,g){var q=this.fileProgressWrapper.find("td:eq(2) .progress"),m=$.parseJSON(g),v;m.url?(v=m.url,str="\x3cdiv\x3e\x3cstrong\x3eLink:\x3c/strong\x3e\x3ca href\x3d"+m.url+" target\x3d'_blank' \x3e "+m.url+"\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3dhash\x3e\x3cstrong\x3eHash:\x3c/strong\x3e"+m.hash+"\x3c/div\x3e"):(l=l.getOption("domain"),v=l+encodeURI(m.key),str="\x3cdiv\x3e\x3cstrong\x3eLink:\x3c/strong\x3e\x3ca href\x3d"+v+" target\x3d'_blank' \x3e "+(l+m.key)+
"\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3dhash\x3e\x3cstrong\x3eHash:\x3c/strong\x3e"+m.hash+"\x3c/div\x3e");q.html(str).removeClass().next().next(".status").hide();q=this.fileProgressWrapper.find(".progressName");l=function(b){var a=["png","jpg","jpeg","gif","bmp"],e=/\.([a-zA-Z0-9]+)(\?|\@|$)/;if(!b||!e.test(b))return!1;b=e.exec(b)[1].toLowerCase();for(var e=0,d=a.length;e<d;e++)if(b===a[e])return!0;return!1}(v);var h=$('\x3cdiv class\x3d"Wrapper"/\x3e');g=$('\x3cdiv class\x3d"imgWrapper col-md-3"/\x3e');var k=$('\x3ca class\x3d"linkWrapper" target\x3d"_blank"/\x3e'),f=$('\x3cimg src\x3d"loading.gif"/\x3e');q.append(h);l?(k.append(f),g.append(k),h.append(g),q=new Image,/imageView/.test(v)||(v+="?imageView2/1/w/100/h/100"),$(q).attr("src",v),$(q).on("load",function(){function b(a,b,d){$("#myModal-img").modal();var c=$("#myModal-img").find(".modal-body");300>=d&&$("#myModal-img").find(".text-warning").show();var e=new Image;c.find("img").attr("src","loading.gif");e.onload=function(){c.find("img").attr("src",a).data("key",b).data("h",d);c.find(".modal-body-wrapper").find("a").attr("href",a)};e.src=a}f.attr("src",v);k.attr("href",v).attr("title","");var a=$('\x3cdiv class\x3d"infoWrapper col-md-6"\x3e\x3c/div\x3e'),e=$('\x3ca class\x3d"fopLink"/\x3e');e.attr("data-key",m.key).text("");a.append(e);e.on("click",function(){var a=$(this).data("key"),c=parseInt($(this).parents(".Wrapper").find(".origin-height").text(),10),c=c>$(window).height()-340?parseInt($(window).height()-340,10):parseInt(c,10)||300,d=[];d.push({fop:"imageView2",mode:3,h:c,q:100,format:"png"});d.push({fop:"watermark",mode:1,image:"http://www.b1.qiniudn.com/images/logo-2.png",dissolve:100,gravity:"SouthEast",dx:100,dy:100});d=Qiniu.pipeline(d,a);$("#myModal-img").on("hide.bs.modal",function(){$("#myModal-img").find(".btn-default").removeClass("disabled");$("#myModal-img").find(".text-warning").hide()}).on("show.bs.modal",function(){$("#myModal-img").find(".imageView").find("a:eq(0)").addClass("disabled");$("#myModal-img").find(".watermark").find("a:eq(3)").addClass("disabled");$("#myModal-img").find(".text-warning").hide()});b(d,a,c);return!1});e=Qiniu.detectIEVersion();if(!(e&&9>=e)){Qiniu.exif(m.key)&&(e=$('\x3ca href\x3d"" target\x3d"_blank"\x3eexif\x3c/a\x3e'),e.attr("href",v+"?exif"),a.append(e));var e=Qiniu.imageInfo(m.key),d=$("\x3cdiv/\x3e");d.html('\x3cdiv\x3ex3cspan class\x3d"origin-format"\x3e'+e.format+'\x3c/span\x3e\x3c/div\x3e\x3cdiv\x3ex3cspan class\x3d"orgin-width"\x3e'+e.width+'px\x3c/span\x3e\x3c/div\x3e\x3cdiv\x3ex3cspan class\x3d"origin-height"\x3e'+
e.height+"px\x3c/span\x3e\x3c/div\x3e");a.append(d)}h.append(a)}).on("error",function(){f.attr("src","default.png");h.addClass("default")})):(f.attr("src","default.png"),h.addClass("default"),g.append(f),h.append(g))};FileProgress.prototype.setError=function(){this.fileProgressWrapper.find("td:eq(2)").attr("class","text-warning");this.fileProgressWrapper.find("td:eq(2) .progress").css("width",0).hide();this.fileProgressWrapper.find("button").hide();this.fileProgressWrapper.next(".chunk-status-tr").hide()};FileProgress.prototype.setCancelled=function(l){var g="progressContainer";l||(g+=" red");this.fileProgressWrapper.attr("class",g);this.fileProgressWrapper.find("td .progress .progress-bar-info").css("width",0)};FileProgress.prototype.setStatus=function(l,g){g||this.fileProgressWrapper.find(".status").text(l).attr("class","status text-left")};FileProgress.prototype.appear=function(){null!==this.getTimer()&&(clearTimeout(this.getTimer()),this.setTimer(null));if(this.fileProgressWrapper[0].filters)try{this.fileProgressWrapper[0].filters.item("DXImageTransform.Microsoft.Alpha").opacity=100}catch(l){this.fileProgressWrapper.css("filter","progid:DXImageTransform.Microsoft.Alpha(opacity\x3d100)")}else this.fileProgressWrapper.css("opacity",1);this.fileProgressWrapper.css("height","");this.height=this.fileProgressWrapper.offset().top;this.opacity=100;this.fileProgressWrapper.show()};function QiniuJsSDK(){this.getQiniuUploadUrl=function(){var g="http://upload.qiniu.com/";"https:"==window.location.protocol&&(g="https://upload.qbox.me/");return g};this.detectIEVersion=function(){for(var g=4,l=document.createElement("div"),m=l.getElementsByTagName("i");l.innerHTML="\x3c!--[if gt IE "+g+"]\x3e\x3ci\x3e\x3c/i\x3e\x3c![endif]--\x3e",m[0];)g++;return 4<g?g:!1};this.isImage=function(g){var l=["png","jpg","jpeg","gif","bmp"],m=/\.([a-zA-Z0-9]+)(\?|\@|$)/;if(!g||!m.test(g))return!1;g=m.exec(g)[1].toLowerCase();for(var m=0,v=l.length;m<v;m++)if(g===l[m])return!0;return!1};this.getFileExtension=function(g){g=g.split(".");return 1===g.length||""===g[0]&&2===g.length?"":g.pop().toLowerCase()};this.utf8_encode=function(g){if(null===g||"undefined"===typeof g)return"";g+="";var l="",m,v,h;m=v=0;h=g.length;for(var k=0;k<h;k++){var f=g.charCodeAt(k),b=null;if(128>f)v++;else if(127<f&&2048>f)b=String.fromCharCode(f>>6|192,f&63|128);else if(f&63488^1)b=String.fromCharCode(f>>12|224,f>>6&63|128,f&63|128);else{if(f&64512^1)throw new RangeError("Unmatched trail surrogate at "+k);b=g.charCodeAt(++k);if(b&64512^1)throw new RangeError("Unmatched lead surrogate at "+(k-1));f=((f&1023)<<10)+(b&1023)+65536;b=String.fromCharCode(f>>18|240,f>>12&63|128,f>>6&63|128,f&63|128)}null!==b&&(v>m&&(l+=g.slice(m,v)),l+=b,m=v=k+1)}v>m&&(l+=g.slice(m,h));return l};this.base64_encode=function(g){var l,m,v,h,k=0,f=0,b=[];if(!g)return g;g=this.utf8_encode(g+"");do l=g.charCodeAt(k++),m=g.charCodeAt(k++),v=g.charCodeAt(k++),h=l<<16|m<<8|v,l=h>>18&63,m=h>>12&63,v=h>>6&63,h&=63,b[f++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(l)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(v)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(h);while(k<g.length);k=b.join("");switch(g.length%3){case 1:k=k.slice(0,-2)+"\x3d\x3d";break;case 2:k=k.slice(0,-1)+"\x3d"}return k};this.URLSafeBase64Encode=function(g){g=this.base64_encode(g);return g.replace(/\//g,"_").replace(/\+/g,"-")};this.createAjax=function(g){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")};this.parseJSON=function(g){if(window.JSON&&window.JSON.parse)return window.JSON.parse(g);if(null===g||"string"===typeof g&&(g=this.trim(g))&&/^[\],:{}\s]*$/.test(g.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return g};this.trim=function(g){return null===g?"":this.trim.call(g)};var l=this;this.uploader=function(g){if(!g.domain)throw"uptoken_url or domain is required!";if(!g.browse_button)throw"browse_button is required!";var q={},m=g.init&&g.init.Error,v=g.init&&g.init.FileUploaded;g.init.Error=function(){};g.init.FileUploaded=function(){};l.uptoken_url=g.uptoken_url;l.token="";l.key_handler="function"===typeof g.init.Key?g.init.Key:"";this.domain=g.domain;var h="",k=!1,f=0,b="",a="";(function(){var a=l.detectIEVersion(),b="Safari"===mOxie.Env.browser&&5>=mOxie.Env.version&&"Windows"===mOxie.Env.os&&"7"===mOxie.Env.osVersion||"Safari"===mOxie.Env.browser&&"iOS"===mOxie.Env.os&&"7"===mOxie.Env.osVersion;a&&9>=a&&g.chunk_size&&0<=g.runtimes.indexOf("flash")?g.chunk_size=0:b?g.chunk_size=0:(a=plupload.parseSize(g.chunk_size),4194304<a&&(g.chunk_size=4194304))})();var e=function(){g.uptoken?l.token=g.uptoken:app.ajax.load({url:l.uptoken_url,callback:function(a){a=JSON.parse(a);console.debug(a.upload_token);l.token=a.upload_token}})},d=function(a,b,d){var c="";g.save_key||(c=(c=(c=a.getOption&&a.getOption("unique_names"))||a.settings&&a.settings.unique_names)?(a=l.getFileExtension(b.name))?b.id+"."+a:b.id:"function"===typeof d?d(a,b):b.name);return c};plupload.extend(q,g,{url:Qiniu.getQiniuUploadUrl(),multipart_params:{token:""}});var r=new plupload.Uploader(q);r.bind("Init",function(a,b){e()});r.init();r.bind("FilesAdded",function(a,b){var c=a.getOption&&a.getOption("auto_start");(c=c||a.settings&&a.settings.auto_start)&&plupload.each(b,function(b,c){a.start()});a.refresh()});r.bind("BeforeUpload",function(a,e){e.speed=e.speed||0;h="";var c=function(a,c,e){b=(new Date).getTime();e=g.save_key?{token:l.token}:{key:d(a,c,e),token:l.token};var f=g.x_vars;if(void 0!==f&&"object"===typeof f)for(var h in f)f.hasOwnProperty(h)&&("function"===typeof f[h]?e["x:"+h]=f[h](a,c):"object"!==typeof f[h]&&(e["x:"+h]=f[h]));a.setOption({url:Qiniu.getQiniuUploadUrl(),multipart:!0,chunk_size:void 0,multipart_params:e})},p=a.getOption&&a.getOption("chunk_size"),p=p||a.settings&&a.settings.chunk_size;if("html5"===r.runtime&&p)if(e.size<p)c(a,e,l.key_handler);else{var c=localStorage.getItem(e.name),n=p;c&&(c=JSON.parse(c),864E5>(new Date).getTime()-(c.time||0)?100!==c.percent?e.size===c.total?(e.percent=c.percent,e.loaded=c.offset,h=c.ctx,k=!0,f=c.offset,c.offset+n>e.size&&(n=e.size-c.offset)):localStorage.removeItem(e.name):localStorage.removeItem(e.name):localStorage.removeItem(e.name));b=(new Date).getTime();a.setOption({url:Qiniu.getQiniuUploadUrl()+"mkblk/"+n,multipart:!1,chunk_size:p,required_features:"chunks",headers:{Authorization:"UpToken "+l.token},multipart_params:{}})}else c(a,e,l.key_handler)});r.bind("UploadProgress",function(c,d){a=(new Date).getTime();c=a-b;var e=d.loaded||0;k&&(e=d.loaded-f);d.speed=(e/c*1E3).toFixed(0)||0});r.bind("ChunkUploaded",function(a,b,d){var c=l.parseJSON(d.response);h=h?h+","+c.ctx:c.ctx;var c=d.total-d.offset,e=a.getOption&&a.getOption("chunk_size"),e=e||a.settings&&a.settings.chunk_size;c<e&&a.setOption({url:Qiniu.getQiniuUploadUrl()+"mkblk/"+c});localStorage.setItem(b.name,JSON.stringify({ctx:h,percent:b.percent,total:d.total,offset:d.offset,time:(new Date).getTime()}))});r.bind("Error",function(a){return function(b,c){var d;if(c.file){switch(c.code){case plupload.FAILED:d=app.resources.QINIU_UPLOADFAILED;break;case plupload.FILE_SIZE_ERROR:d=(d=b.getOption&&b.getOption("max_file_size"))||b.settings&&b.settings.max_file_size;d=app.resources.QINIU_FILE_SIZE_ERROR+
d+app.resources.QINIU_FILE_SIZE_ERROR_2;break;case plupload.FILE_EXTENSION_ERROR:d=app.resources.QINIU_FILE_EXTESION_ERROR;break;case plupload.HTTP_ERROR:var e=l.parseJSON(c.response),f=e.error;switch(c.status){case 400:d=app.resources.QINIU_MESSAGE_FORMAT_ERROR;break;case 401:d=app.resources.QINIU_AUTHORIZATION_FAILED;break;case 405:d=app.resources.QINIU_REQUESET_ERROR;break;case 579:d=app.resources.QINIU_CALL_BACK_ERROR;break;case 599:d=app.resources.QINIU_NETWORK_ERROR;break;case 614:d=app.resources.QINIU_FILE_EXIST;try{e=l.parseJSON(e.error),f=e.error||"file exists"}catch(R){f=e.error||"file exists"}break;case 631:d=app.resources.QINIU_NO_BUCKET_ERROR;break;case 701:d=app.resources.QINIU_DATA_VALIDATION_FAILED;break;default:d=app.resources.QINIU_UNKNOW_ERROR}d=d+"("+c.status+""+f+")";break;case plupload.SECURITY_ERROR:d=app.resources.QINIU_CONFIG_ERROR;break;case plupload.GENERIC_ERROR:d=app.resources.QINIU_UPLOAD_FILE_FAILED;break;case plupload.IO_ERROR:d=app.resources.QINIU_UPLOAD_FILE_FAILED;break;case plupload.INIT_ERROR:d=app.resources.QINIU_CONFIG_ERROR;r.destroy();break;default:d=c.message+c.details}a&&a(b,c,d)}b.refresh()}}(m));r.bind("FileUploaded",function(a){return function(b,c,e){var f=function(b,c,d){if(g.downtoken_url){var e=l.createAjax();e.open("POST",g.downtoken_url,!0);e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status){var f;try{f=l.parseJSON(e.responseText)}catch(z){throw"invalid json format";}var g={};plupload.extend(g,l.parseJSON(d),f);a&&a(b,c,JSON.stringify(g))}else r.trigger("Error",{status:e.status,response:e.responseText,file:c,code:plupload.HTTP_ERROR})};e.send("key\x3d"+l.parseJSON(d).key+"\x26domain\x3d"+g.domain)}else a&&a(b,c,d)},k=l.parseJSON(e.response);if(h=h?h:k.ctx){e="";g.save_key||(e=(e=d(b,c,l.key_handler))?"/key/"+l.URLSafeBase64Encode(e):"");var k=g.x_vars,p="",m="";if(void 0!==k&&"object"===typeof k)for(var n in k)k.hasOwnProperty(n)&&("function"===typeof k[n]?p=l.URLSafeBase64Encode(k[n](b,c)):"object"!==typeof k[n]&&(p=l.URLSafeBase64Encode(k[n])),m+="/x:"+n+"/"+p);n=Qiniu.getQiniuUploadUrl()+"mkfile/"+c.size+e+m;var t=l.createAjax();t.open("POST",n,!0);t.setRequestHeader("Content-Type","text/plain;charset\x3dUTF-8");t.setRequestHeader("Authorization","UpToken "+l.token);t.onreadystatechange=function(){4===t.readyState&&(localStorage.removeItem(c.name),200===t.status?f(b,c,t.responseText):r.trigger("Error",{status:t.status,response:t.responseText,file:c,code:-200}))};t.send(h)}else f(b,c,e.response)}}(v));return r};this.getUrl=function(g){if(!g)return!1;g=encodeURI(g);var l=this.domain;"/"!==l.slice(l.length-1)&&(l+="/");return l+g};this.imageView2=function(g,l){var m=g.mode||"",q=g.w||"",h=g.h||"",k=g.q||"";g=g.format||"";if(!m||!q&&!h)return!1;m="imageView2/"+m+(q?"/w/"+q:"")+(h?"/h/"+h:"");m+=k?"/q/"+k:"";m+=g?"/format/"+g:"";l&&(m=this.getUrl(l)+"?"+m);return m};this.imageMogr2=function(g,l){var m=g.thumbnail||"",q=g.strip||"",h=g.gravity||"",k=g.crop||"",f=g.quality||"",b=g.rotate||"",a=g.format||"",e=g.blur||"";g="imageMogr2"+(g["auto-orient"]?"/auto-orient":"")+(m?"/thumbnail/"+m:"");g=g+(q?"/strip":"")+(h?"/gravity/"+h:"");g+=f?"/quality/"+f:"";g+=k?"/crop/"+k:"";g+=b?"/rotate/"+b:"";g+=a?"/format/"+a:"";g+=e?"/blur/"+e:"";l&&(g=this.getUrl(l)+"?"+g);return g};this.watermark=function(g,l){var m=g.mode;if(!m)return!1;var q="watermark/"+m;if(1===m){m=g.image||"";if(!m)return!1;q+=m?"/image/"+this.URLSafeBase64Encode(m):""}else if(2===m){var m=g.text?g.text:"",h=g.font?g.font:"",k=g.fontsize?g.fontsize:"",f=g.fill?g.fill:"";if(!m)return!1;q+=m?"/text/"+this.URLSafeBase64Encode(m):"";q+=h?"/font/"+this.URLSafeBase64Encode(h):"";q=q+(k?"/fontsize/"+k:"")+(f?"/fill/"+this.URLSafeBase64Encode(f):"")}else return!1;m=g.dissolve||"";h=g.gravity||"";k=g.dx||"";g=g.dy||"";q=q+(m?"/dissolve/"+m:"")+(h?"/gravity/"+h:"");q+=k?"/dx/"+k:"";q+=g?"/dy/"+g:"";l&&(q=this.getUrl(l)+"?"+q);return q};this.imageInfo=function(g){if(!g)return!1;g=this.getUrl(g)+"?imageInfo";var l=this.createAjax(),m,v=this;l.open("GET",g,!1);l.onreadystatechange=function(){4===l.readyState&&200===l.status&&(m=v.parseJSON(l.responseText))};l.send();return m};this.exif=function(g){if(!g)return!1;g=this.getUrl(g)+"?exif";var l=this.createAjax(),m,v=this;l.open("GET",g,!1);l.onreadystatechange=function(){4===l.readyState&&200===l.status&&(m=v.parseJSON(l.responseText))};l.send();return m};this.get=function(g,l){return l&&g?"exif"===g?this.exif(l):"imageInfo"===g?this.imageInfo(l):!1:!1};this.pipeline=function(g,l){var m,q,h="";if("[object Array]"===Object.prototype.toString.call(g)){for(var k=0,f=g.length;k<f;k++){m=g[k];if(!m.fop)return!1;switch(m.fop){case "watermark":h+=this.watermark(m)+"|";break;case "imageView2":h+=this.imageView2(m)+"|";break;case "imageMogr2":h+=this.imageMogr2(m)+"|";break;default:q=!0}if(q)return!1}l&&(h=this.getUrl(l)+"?"+h,g=h.length,"|"===h.slice(g-1)&&(h=h.slice(0,g-1)));return h}return!1}}var Qiniu=new QiniuJsSDK;(function(l,g){function q(a){b.document.on("dialogclose",function(a){c||"undefined"===typeof Blob||f()||g("#"+r).prop("src",b.noImagePath);c=!1})}function m(a){v();b.uploadImageButton.on("click",function(a){a.preventDefault()});b.document.on("click",".image_preview_item",function(a){a={url:l.urls.imageViewDialog,data:{imageURL:g(this).find("img").prop("src")},callback:function(){},options:{dialogClass:"dialog_image_view_dialog"}};l.dialog.open(a)});g(".image_item").mouseenter(function(){e.refresh()})}
function v(){e=Qiniu.uploader({runtimes:l.preferences.QINIURUNTIMES,container:a.contanierElement,browse_button:["pickfiles1","pickfiles2","pickfiles3"],uptoken_url:l.urls.generateUploadToken,unique_names:a.uniqueFileName,save_key:a.saveKey,domain:l.preferences.QINIUDOMAIN,flash_swf_url:l.preferences.QINIUSWFURL,silverlight_xap_url:l.preferences.QINIUSWFXAPURL,max_retries:a.maximumRetries,max_file_count:a.maximumFileCount,dragdrop:a.isEnableDropFile,drop_element:a.contanierElement,chunk_size:"0",auto_start:a.autoStartUploadFile,max_file_size:l.preferences.QINIUMAXFILESIZE||"4mb",filters:{max_file_size:l.preferences.QINIUMAXFILESIZE||"4mb",mime_types:[{title:"Image files",extensions:a.fileExtensions}],prevent_duplicates:!1},init:{FilesAdded:function(a,c,d,e,f){b.filesLength=c.length;plupload.each(c,function(b){b.name==e&&h(b,function(c){var e=g(d).find("img").prop("id");null!=e&&a.removeFile(e);g(d).find("img").prop("src",c);g(d).find("img").prop("id",b.id);r=b.id;0==f&&k(c,b,e,a)});(new FileProgress(b,"fsUploadProgress")).setStatus("wait...")})},BeforeUpload:function(a,b){b=new FileProgress(b,"fsUploadProgress");var c=plupload.parseSize(this.getOption("chunk_size"));"html5"===a.runtime&&c&&b.setChunkProgess(c)},UploadProgress:function(a,b){a=new FileProgress(b,"fsUploadProgress");var c=plupload.parseSize(this.getOption("chunk_size"));a.setProgress(b.percent+"%",b.speed,c)},FileUploaded:function(a,c,d){(new FileProgress(c,"fsUploadProgress")).setComplete(a,d);a=JSON.parse(d);b.fileList.push(a.key)},Error:function(a,c,d){a=new FileProgress(c.file,"fsUploadProgress");a.setError();a.setStatus(d);alert(d);b.document.trigger("file.upload.error",d);return!1},UploadComplete:function(){for(var a=[],c=0;c<b.fileList.length;c++){var e=b.fileList[c].substring(b.fileList[c].lastIndexOf("/")+1);a.push(e)}c=1<a.length?a.join(","):a[0];b.imageList.val(c);"CancelUpload"!=d&&b.document.trigger("file.upload.completed",a)},Key:function(a,b){a=l.preferences.QINIUFLODERPREFIX+b.id+".";b=b.name.split(".");b=1===b.length||""===b[0]&&2===b.length?"":b.pop().toLowerCase();return a+b},CancelUpload:function(){d="CancelUpload";b.document.trigger("file.upload.cancel");return!1},StateChanged:function(a){}}})}function h(a,b){if(a&&/image\//.test(a.type))if("image/gif"==a.type){var c=new mOxie.FileReader;c.onload=function(){b(c.result);c.destroy();c=null};c.readAsDataURL(a.getSource())}else{var d=new mOxie.Image;d.onload=function(){var a="image/jpeg"==d.type?d.getAsDataURL("image/jpeg",100):d.getAsDataURL();b&&b(a);d.destroy();d=null};d.load(a.getSource())}}function k(a,b,d,e){l.dialog.open({url:l.urls.imageCropperDialog,callback:function(){var h=g(".img-container").find("img");h.prop("src",a);h.cropper({aspectRatio:1,preview:".img-preview",data:"Object",responsive:!0,autoCrop:!0,movable:!1,zoomable:!1,guides:!1,highlight:!1,crop:function(a){}});var k=g(".loading_icon");g(".js_image_save_button").on("click",function(a){k.fadeIn();a=h.cropper("getCroppedCanvas");var m=a.toDataURL(),n;if(n="undefined"!==typeof Blob&&!f())n=!(-1<window.navigator.userAgent.indexOf("UCBrowser"));n&&(n="MicroMessenger"!=window.navigator.userAgent.match(/MicroMessenger/i));if(n){m=m.split(",");a=m[0].match(/:(.*?);/)[1];m=atob(m[1]);n=m.length;for(var p=new Uint8Array(n);n--;)p[n]=m.charCodeAt(n);a=new Blob([p],{type:a})}else m=new Image,m.src=a.toDataURL("image/png"),a=m;g("#isProductReviewIamgeAdded").val("true");e.removeFile(d);e.addFile(a,b.name,!0);c=!0;l.dialog.close()})},options:{dialogClass:"dialog_image_cropper",width:"60%"}})}function f(){var a=window.navigator.userAgent;return-1<a.indexOf("MSIE ")||-1<a.indexOf("Trident/")}var b={},a={},e={},d="",r="",c=!1,n={contanierElement:"image_upload_container",autoStartUploadFile:!1,saveKey:!1,uniqueFileName:!1,isEnableDropFile:!0,maximumRetries:l.preferences.QINIUMAXRETRIES||3,maximumFileCount:3,fileExtensions:"jpg,gif,png,jpeg",isEnableCustomerImage:l.preferences.ENABLE_CUSTOMER_IMGAGE};l.components=l.components||{};l.components.global=l.components.global||{};l.components.global.qiniu={init:function(c){"true"==l.preferences.ENABLE_CUSTOMER_IMGAGE&&(a=g.extend({},n,c),b={window:g(window),document:g(document),uploadImageButton:g(".js_upload_image"),filesLength:0,imageServiceDomain:g("#image_service_domain"),fileList:[],imageList:g("#imageList"),imageViewWrapper:g(".image_view_wrapper"),noImagePath:g("#pickfiles1").find("img").prop("src")},m(c),q(c))},upload:function(){if("true"==l.preferences.ENABLE_CUSTOMER_IMGAGE)return e.start(),!1}}})(window.app=window.app||{},jQuery);(function(l){"function"===typeof define&&define.amd?define(["jquery"],l):"object"===typeof exports?l(require("jquery")):l(jQuery)})(function(l){function g(a){return"number"===typeof a&&!isNaN(a)}function q(a){return"undefined"===typeof a}function m(a,b){var c=[];g(b)&&c.push(b);return c.slice.apply(a,c)}function v(a,b){var c=m(arguments,2);return function(){return a.apply(b,c.concat(m(arguments)))}}function h(a){return(a=a.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i))&&(a[1]!==A.protocol||a[2]!==A.hostname||a[3]!==A.port)}function k(a){var b="timestamp\x3d"+(new Date).getTime();return a+(-1===a.indexOf("?")?"?":"\x26")+b}function f(a){return a?' crossOrigin\x3d"'+a+'"':""}function b(a,b){var c;if(a.naturalWidth&&!y)return b(a.naturalWidth,a.naturalHeight);c=document.createElement("img");c.onload=function(){b(this.width,this.height)};c.src=a.src}function a(a){var b=[],c=a.rotate,d=a.scaleX;a=a.scaleY;g(d)&&g(a)&&b.push("scale("+d+","+a+")");g(c)&&b.push("rotate("+c+"deg)");return b.length?b.join(" "):"none"}function e(a,b){var c=I(a.degree)%180,d=(90<c?180-c:c)*Math.PI/180,c=Q(d),d=F(d),e=a.width,f=a.height;a=a.aspectRatio;b?(b=e/(d+c/a),c=b/a):(b=e*d+f*c,c=e*c+f*d);return{width:b,height:c}}function d(a,b){var c=l("\x3ccanvas\x3e")[0],d=c.getContext("2d"),f=0,h=0,w=b.naturalWidth,k=b.naturalHeight,x=b.rotate,m=b.scaleX;b=b.scaleY;var n=g(m)&&g(b)&&(1!==m||1!==b),p=g(x)&&0!==x,r=p||n,q=w*I(m||1),u=k*I(b||1),t,v;n&&(t=q/2,v=u/2);p&&(t=e({width:q,height:u,degree:x}),q=t.width,u=t.height,t=q/2,v=u/2);c.width=q;c.height=u;r&&(f=-w/2,h=-k/2,d.save(),d.translate(t,v));n&&d.scale(m,b);p&&d.rotate(x*Math.PI/180);d.drawImage(a,K(f),K(h),K(w),K(k));r&&d.restore();return c}function r(a){var b=a.length,c=0,d=0;b&&(l.each(a,function(a,b){c+=b.pageX;d+=b.pageY}),c/=b,d/=b);return{pageX:c,pageY:d}}function c(a){a=a.replace(H,"");a=atob(a);var b=a.length,c=new R(b),d=new N(c),e;for(e=0;e<b;e++)d[e]=a.charCodeAt(e);return c}function n(a,b){this.$element=l(a);this.options=l.extend({},n.DEFAULTS,l.isPlainObject(b)&&b);this.isImg=this.wheeling=this.isLimited=this.isReplaced=this.isDisabled=this.isCropped=this.isRotated=this.isCompleted=this.isBuilt=this.isLoaded=!1;this.originalUrl="";this.cropBox=this.canvas=null;this.init()}var t=l(window),p=l(document),A=window.location,u=window.navigator,R=window.ArrayBuffer,N=window.Uint8Array,O=window.DataView,U=window.btoa,G=/e|w|s|n|se|sw|ne|nw|all|crop|move|zoom/,D=/^data\:/,H=/^data\:([^\;]+)\;base64,/,L=/^data\:image\/jpeg.*;base64,/,P=l.isFunction(l("\x3ccanvas\x3e")[0].getContext),y=u&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(u.userAgent),z=Number,B=Math.min,C=Math.max,I=Math.abs,Q=Math.sin,F=Math.cos,M=Math.sqrt,E=Math.round,K=Math.floor,S=String.fromCharCode;n.prototype={constructor:n,init:function(){var a=this.$element,b;if(a.is("img")){this.isImg=!0;this.originalUrl=b=a.attr("src");if(!b)return;b=a.prop("src")}else a.is("canvas")&&P&&(b=a[0].toDataURL());this.load(b)},trigger:function(a,b){a=l.Event(a,b);this.$element.trigger(a);return a},load:function(a){var b=this.options,d=this.$element,e,f;if(a&&(d.one("build.cropper",b.build),!this.trigger("build.cropper").isDefaultPrevented())){this.url=a;this.image={};if(!b.checkOrientation||!R)return this.clone();e=l.proxy(this.read,this);if(D.test(a))return L.test(a)?e(c(a)):this.clone();f=new XMLHttpRequest;f.onerror=f.onabort=l.proxy(function(){this.clone()},this);f.onload=function(){e(this.response)};b.checkCrossOrigin&&h(a)&&d.prop("crossOrigin")&&(a=k(a));f.open("get",a);f.responseType="arraybuffer";f.send()}},read:function(a){var b=this.options,c;c=new O(a);var d=c.byteLength,e,f,g,h,k;if(255===c.getUint8(0)&&216===c.getUint8(1))for(k=2;k<d;){if(255===c.getUint8(k)&&225===c.getUint8(k+1)){f=k;break}k++}if(f){var d=f+10,w=f+4;f="";k=w;for(w=4+w;k<w;k++)f+=S(c.getUint8(k));"Exif"===f&&(f=c.getUint16(d),!(g=18761===f)&&19789!==f||42!==c.getUint16(d+2,g)||(f=c.getUint32(d+4,g),8<=f&&(h=d+f)))}if(h)for(d=c.getUint16(h,g),f=0;f<d;f++)if(k=h+12*f+2,274===c.getUint16(k,g)){k+=8;e=c.getUint16(k,g);y&&c.setUint16(k,1,g);break}c=e;e=this.image;var l,m,n;if(1<c){a=new N(a);g=a.length;h="";for(d=0;d<g;d++)h+=S(a[d]);this.url="data:image/jpeg;base64,"+U(h);switch(c){case 2:m=-1;break;case 3:l=-180;break;case 4:n=-1;break;case 5:l=90;n=-1;break;case 6:l=90;break;case 7:l=90;m=-1;break;case 8:l=-90}}b.rotatable&&(e.rotate=l);b.scalable&&(e.scaleX=m,e.scaleY=n);this.clone()},clone:function(){var a=this.$element,b=this.url,c="",d;this.options.checkCrossOrigin&&h(b)&&((c=a.prop("crossOrigin"))?d=b:(c="anonymous",d=k(b)));this.crossOrigin=c;this.crossOriginUrl=d;this.$clone=b=l("\x3cimg"+f(c)+' src\x3d"'+(d||b)+'"\x3e');if(this.isImg)if(a[0].complete)this.start();else a.one("load.cropper",l.proxy(this.start,this));else b.one("load.cropper",l.proxy(this.start,this)).one("error.cropper",l.proxy(this.stop,this)).addClass("cropper-hide").insertAfter(a)},start:function(){var a=this.$element,c=this.$clone;this.isImg||(c.off("error.cropper",this.stop),a=c);b(a[0],l.proxy(function(a,b){l.extend(this.image,{naturalWidth:a,naturalHeight:b,aspectRatio:a/b});this.isLoaded=!0;this.build()},this))},stop:function(){this.$clone.remove();this.$clone=null},build:function(){var a=this.options,b=this.$element,c=this.$clone,d,e,f;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=b.parent(),this.$cropper=d=l(n.TEMPLATE),this.$canvas=d.find(".cropper-canvas").append(c),this.$dragBox=d.find(".cropper-drag-box"),this.$cropBox=e=d.find(".cropper-crop-box"),this.$viewBox=d.find(".cropper-view-box"),this.$face=f=e.find(".cropper-face"),b.addClass("cropper-hidden").after(d),this.isImg||c.removeClass("cropper-hide"),this.initPreview(),this.bind(),a.aspectRatio=C(0,a.aspectRatio)||NaN,a.viewMode=C(0,B(3,E(a.viewMode)))||0,a.autoCrop?(this.isCropped=!0,a.modal&&this.$dragBox.addClass("cropper-modal")):e.addClass("cropper-hidden"),a.guides||e.find(".cropper-dashed").addClass("cropper-hidden"),a.center||e.find(".cropper-center").addClass("cropper-hidden"),a.cropBoxMovable&&f.addClass("cropper-move").data("action","all"),a.highlight||f.addClass("cropper-invisible"),a.background&&d.addClass("cropper-bg"),a.cropBoxResizable||e.find(".cropper-line, .cropper-point").addClass("cropper-hidden"),this.setDragMode(a.dragMode),this.render(),this.isBuilt=!0,this.setData(a.data),b.one("built.cropper",a.built),setTimeout(l.proxy(function(){this.trigger("built.cropper");this.trigger("crop.cropper",this.getData());this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isCompleted=this.isBuilt=!1,this.cropBox=this.canvas=this.container=this.initialCropBox=this.initialCanvas=this.initialImage=null,this.unbind(),this.resetPreview(),this.$container=this.$canvas=this.$dragBox=this.$cropBox=this.$viewBox=this.$preview=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer();this.initCanvas();this.initCropBox();this.renderCanvas();this.isCropped&&this.renderCropBox()},initContainer:function(){var a=this.options,b=this.$element,c=this.$container,d=this.$cropper;d.addClass("cropper-hidden");b.removeClass("cropper-hidden");d.css(this.container={width:C(c.width(),z(a.minContainerWidth)||200),height:C(c.height(),z(a.minContainerHeight)||100)});b.addClass("cropper-hidden");d.removeClass("cropper-hidden")},initCanvas:function(){var a=this.options.viewMode,b=this.container,c=b.width,b=b.height,d=this.image,e=d.naturalWidth,f=d.naturalHeight,g=90===I(d.rotate),h=g?f:e,g=g?e:f,k=h/g,e=c,f=b;b*k>c?3===a?e=b*k:f=c/k:3===a?f=c/k:e=b*k;h={naturalWidth:h,naturalHeight:g,aspectRatio:k,width:e,height:f};h.oldLeft=h.left=(c-e)/2;h.oldTop=h.top=(b-f)/2;this.canvas=h;this.isLimited=1===a||2===a;this.limitCanvas(!0,!0);this.initialImage=l.extend({},d);this.initialCanvas=l.extend({},h)},limitCanvas:function(a,b){var c=this.options,d=c.viewMode,e=this.container,f=e.width,e=e.height,g=this.canvas,h=g.aspectRatio,k=this.cropBox,l=this.isCropped&&k;a&&(a=z(c.minCanvasWidth)||0,c=z(c.minCanvasHeight)||0,d&&(1<d?(a=C(a,f),c=C(c,e),3===d&&(c*h>a?a=c*h:c=a/h)):a?a=C(a,l?k.width:0):c?c=C(c,l?k.height:0):l&&(a=k.width,c=k.height,c*h>a?a=c*h:c=a/h)),a&&c?c*h>a?c=a/h:a=c*h:a?c=a/h:c&&(a=c*h),g.minWidth=a,g.minHeight=c,g.maxWidth=Infinity,g.maxHeight=Infinity);b&&(d?(b=f-g.width,c=e-g.height,g.minLeft=B(0,b),g.minTop=B(0,c),g.maxLeft=C(0,b),g.maxTop=C(0,c),l&&this.isLimited&&(g.minLeft=B(k.left,k.left+k.width-g.width),g.minTop=B(k.top,k.top+k.height-g.height),g.maxLeft=k.left,g.maxTop=k.top,2===d&&(g.width>=f&&(g.minLeft=B(0,b),g.maxLeft=C(0,b)),g.height>=e&&(g.minTop=B(0,c),g.maxTop=C(0,c))))):(g.minLeft=-g.width,g.minTop=-g.height,g.maxLeft=f,g.maxTop=e))},renderCanvas:function(a){var b=this.canvas,c=this.image,d=c.rotate,f=c.naturalWidth,g=c.naturalHeight,h;this.isRotated&&(this.isRotated=!1,h=e({width:c.width,height:c.height,degree:d}),c=h.width/h.height,c!==b.aspectRatio&&(b.left-=(h.width-b.width)/2,b.top-=(h.height-b.height)/2,b.width=h.width,b.height=h.height,b.aspectRatio=c,b.naturalWidth=f,b.naturalHeight=g,d%180&&(h=e({width:f,height:g,degree:d}),b.naturalWidth=h.width,b.naturalHeight=h.height),this.limitCanvas(!0,!1)));if(b.width>b.maxWidth||b.width<b.minWidth)b.left=b.oldLeft;if(b.height>b.maxHeight||b.height<b.minHeight)b.top=b.oldTop;b.width=B(C(b.width,b.minWidth),b.maxWidth);b.height=B(C(b.height,b.minHeight),b.maxHeight);this.limitCanvas(!1,!0);b.oldLeft=b.left=B(C(b.left,b.minLeft),b.maxLeft);b.oldTop=b.top=B(C(b.top,b.minTop),b.maxTop);this.$canvas.css({width:b.width,height:b.height,left:b.left,top:b.top});this.renderImage();this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0);a&&this.output()},renderImage:function(b){var c=this.canvas,d=this.image,f;d.rotate&&(f=e({width:c.width,height:c.height,degree:d.rotate,aspectRatio:d.aspectRatio},!0));l.extend(d,f?{width:f.width,height:f.height,left:(c.width-f.width)/2,top:(c.height-f.height)/2}:{width:c.width,height:c.height,left:0,top:0});this.$clone.css({width:d.width,height:d.height,marginLeft:d.left,marginTop:d.top,transform:a(d)});b&&this.output()},initCropBox:function(){var a=this.options,b=this.canvas,c=a.aspectRatio,a=z(a.autoCropArea)||.8,d={width:b.width,height:b.height};c&&(b.height*c>b.width?d.height=d.width/c:d.width=d.height*c);this.cropBox=d;this.limitCropBox(!0,!0);d.width=B(C(d.width,d.minWidth),d.maxWidth);d.height=B(C(d.height,d.minHeight),d.maxHeight);d.width=C(d.minWidth,d.width*a);d.height=C(d.minHeight,d.height*a);d.oldLeft=d.left=b.left+(b.width-d.width)/2;d.oldTop=d.top=b.top+(b.height-d.height)/2;this.initialCropBox=l.extend({},d)},limitCropBox:function(a,b){var c=this.options,d=c.aspectRatio,e=this.container,f=e.width,e=e.height,g=this.canvas,h=this.cropBox,k=this.isLimited,l,w;a&&(a=z(c.minCropBoxWidth)||0,c=z(c.minCropBoxHeight)||0,a=B(a,f),c=B(c,e),l=B(f,k?g.width:f),w=B(e,k?g.height:e),d&&(a&&c?c*d>a?c=a/d:a=c*d:a?c=a/d:c&&(a=c*d),w*d>l?w=l/d:l=w*d),h.minWidth=B(a,l),h.minHeight=B(c,w),h.maxWidth=l,h.maxHeight=w);b&&(k?(h.minLeft=C(0,g.left),h.minTop=C(0,g.top),h.maxLeft=B(f,g.left+g.width)-h.width,h.maxTop=B(e,g.top+g.height)-h.height):(h.minLeft=0,h.minTop=0,h.maxLeft=f-h.width,h.maxTop=e-h.height))},renderCropBox:function(){var a=this.options,b=this.container,c=b.width,b=b.height,d=this.cropBox;if(d.width>d.maxWidth||d.width<d.minWidth)d.left=d.oldLeft;if(d.height>d.maxHeight||d.height<d.minHeight)d.top=d.oldTop;d.width=B(C(d.width,d.minWidth),d.maxWidth);d.height=B(C(d.height,d.minHeight),d.maxHeight);this.limitCropBox(!1,!0);d.oldLeft=d.left=B(C(d.left,d.minLeft),d.maxLeft);d.oldTop=d.top=B(C(d.top,d.minTop),d.maxTop);a.movable&&a.cropBoxMovable&&this.$face.data("action",d.width===c&&d.height===b?"move":"all");this.$cropBox.css({width:d.width,height:d.height,left:d.left,top:d.top});this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0);this.isDisabled||this.output()},output:function(){this.preview();this.isCompleted&&this.trigger("crop.cropper",this.getData())},initPreview:function(){var a=f(this.crossOrigin),b=a?this.crossOriginUrl:this.url,c;this.$preview=l(this.options.preview);this.$clone2=c=l("\x3cimg"+a+' src\x3d"'+b+'"\x3e');this.$viewBox.html(c);this.$preview.each(function(){var c=l(this);c.data("preview",{width:c.width(),height:c.height(),html:c.html()});c.html("\x3cimg"+a+' src\x3d"'+b+'" style\x3d"display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"\x3e')})},resetPreview:function(){this.$preview.each(function(){var a=l(this),b=a.data("preview");a.css({width:b.width,height:b.height}).html(b.html).removeData("preview")})},preview:function(){var b=this.image,c=this.canvas,d=this.cropBox,e=d.width,f=d.height,g=b.width,h=b.height,k=d.left-c.left-b.left,m=d.top-c.top-b.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:g,height:h,marginLeft:-k,marginTop:-m,transform:a(b)}),this.$preview.each(function(){var c=l(this),d=c.data("preview"),w=d.width,d=d.height,n=w,p=d,x=1;e&&(x=w/e,p=f*x);f&&p>d&&(x=d/f,n=e*x,p=d);c.css({width:n,height:p}).find("img").css({width:g*x,height:h*x,marginLeft:-k*x,marginTop:-m*x,transform:a(b)})}))},bind:function(){var a=this.options,b=this.$element,c=this.$cropper;if(l.isFunction(a.cropstart))b.on("cropstart.cropper",a.cropstart);if(l.isFunction(a.cropmove))b.on("cropmove.cropper",a.cropmove);if(l.isFunction(a.cropend))b.on("cropend.cropper",a.cropend);if(l.isFunction(a.crop))b.on("crop.cropper",a.crop);if(l.isFunction(a.zoom))b.on("zoom.cropper",a.zoom);c.on("mousedown touchstart pointerdown MSPointerDown",l.proxy(this.cropStart,this));if(a.zoomable&&a.zoomOnWheel)c.on("wheel mousewheel DOMMouseScroll",l.proxy(this.wheel,this));if(a.toggleDragModeOnDblclick)c.on("dblclick",l.proxy(this.dblclick,this));p.on("mousemove touchmove pointermove MSPointerMove",this._cropMove=v(this.cropMove,this)).on("mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",this._cropEnd=v(this.cropEnd,this));if(a.responsive)t.on("resize.cropper",this._resize=v(this.resize,this))},unbind:function(){var a=this.options,b=this.$element,c=this.$cropper;l.isFunction(a.cropstart)&&b.off("cropstart.cropper",a.cropstart);l.isFunction(a.cropmove)&&b.off("cropmove.cropper",a.cropmove);l.isFunction(a.cropend)&&b.off("cropend.cropper",a.cropend);l.isFunction(a.crop)&&b.off("crop.cropper",a.crop);l.isFunction(a.zoom)&&b.off("zoom.cropper",a.zoom);c.off("mousedown touchstart pointerdown MSPointerDown",this.cropStart);a.zoomable&&a.zoomOnWheel&&c.off("wheel mousewheel DOMMouseScroll",this.wheel);a.toggleDragModeOnDblclick&&c.off("dblclick",this.dblclick);p.off("mousemove touchmove pointermove MSPointerMove",this._cropMove).off("mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",this._cropEnd);a.responsive&&t.off("resize.cropper",this._resize)},resize:function(){var a=this.options.restore,b=this.$container,c=this.container,d,e,f;!this.isDisabled&&c&&(f=b.width()/c.width,1!==f||b.height()!==c.height)&&(a&&(d=this.getCanvasData(),e=this.getCropBoxData()),this.render(),a&&(this.setCanvasData(l.each(d,function(a,b){d[a]=b*f})),this.setCropBoxData(l.each(e,function(a,b){e[a]=b*f}))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass("cropper-crop")?this.setDragMode("move"):this.setDragMode("crop"))},wheel:function(a){var b=a.originalEvent||a,c=z(this.options.wheelZoomRatio)||.1,d=1;this.isDisabled||(a.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(l.proxy(function(){this.wheeling=!1},this),50),b.deltaY?d=0<b.deltaY?1:-1:b.wheelDelta?d=-b.wheelDelta/120:b.detail&&(d=0<b.detail?1:-1),this.zoom(-d*c,a)))},cropStart:function(a){var b=this.options,c=a.originalEvent,d=c&&c.touches,e=a,f;if(!this.isDisabled){if(d){e=d.length;if(1<e)if(b.zoomable&&b.zoomOnTouch&&2===e)e=d[1],this.startX2=e.pageX,this.startY2=e.pageY,f="zoom";else return;e=d[0]}f=f||l(e.target).data("action");G.test(f)&&!this.trigger("cropstart.cropper",{originalEvent:c,action:f}).isDefaultPrevented()&&(a.preventDefault(),this.action=f,this.cropping=!1,this.startX=e.pageX||c&&c.pageX,this.startY=e.pageY||c&&c.pageY,"crop"===f&&(this.cropping=!0,this.$dragBox.addClass("cropper-modal")))}},cropMove:function(a){var b=this.options,c=a.originalEvent,d=c&&c.touches,e=a,f=this.action;if(!this.isDisabled){if(d){e=d.length;if(1<e)if(b.zoomable&&b.zoomOnTouch&&2===e)e=d[1],this.endX2=e.pageX,this.endY2=e.pageY;else return;e=d[0]}f&&!this.trigger("cropmove.cropper",{originalEvent:c,action:f}).isDefaultPrevented()&&(a.preventDefault(),this.endX=e.pageX||c&&c.pageX,this.endY=e.pageY||c&&c.pageY,this.change(e.shiftKey,"zoom"===f?a:null))}},cropEnd:function(a){var b=a.originalEvent,c=this.action;!this.isDisabled&&c&&(a.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass("cropper-modal",this.isCropped&&this.options.modal)),this.action="",this.trigger("cropend.cropper",{originalEvent:b,action:c}))},change:function(a,b){var c,d,e,f=this.options.aspectRatio,g=this.action;c=this.container;d=this.canvas;var h=this.cropBox,k=h.width,l=h.height,m=h.left,n=h.top,p=m+k,w=n+l,x=0,q=0,r=c.width,u=c.height,t=!0;!f&&a&&(f=k&&l?k/l:1);this.isLimited&&(x=h.minLeft,q=h.minTop,r=x+B(c.width,d.left+d.width),u=q+B(c.height,d.top+d.height));a=this.endX-this.startX;c=this.endY-this.startY;e=d=void 0;f&&(d=c*f,e=a/f);switch(g){case "all":m+=a;n+=c;break;case "e":if(0<=a&&(p>=r||f&&(n<=q||w>=u))){t=!1;break}k+=a;f&&(l=k/f,n-=e/2);0>k&&(g="w",k=0);break;case "n":if(0>=c&&(n<=q||f&&(m<=x||p>=r))){t=!1;break}l-=c;n+=c;f&&(k=l*f,m+=d/2);0>l&&(g="s",l=0);break;case "w":if(0>=a&&(m<=x||f&&(n<=q||w>=u))){t=!1;break}k-=a;m+=a;f&&(l=k/f,n+=e/2);0>k&&(g="e",k=0);break;case "s":if(0<=c&&(w>=u||f&&(m<=x||p>=r))){t=!1;break}l+=c;f&&(k=l*f,m-=d/2);0>l&&(g="n",l=0);break;case "ne":if(f){if(0>=c&&(n<=q||p>=r)){t=!1;break}l-=c;n+=c;k=l*f}else 0<=a?p<r?k+=a:0>=c&&n<=q&&(t=!1):k+=a,0>=c?n>q&&(l-=c,n+=c):(l-=c,n+=c);0>k&&0>l?(g="sw",k=l=0):0>k?(g="nw",k=0):0>l&&(g="se",l=0);break;case "nw":if(f){if(0>=c&&(n<=q||m<=x)){t=!1;break}l-=c;n+=c;k=l*f;m+=d}else 0>=a?m>x?(k-=a,m+=a):0>=c&&n<=q&&(t=!1):(k-=a,m+=a),0>=c?n>q&&(l-=c,n+=c):(l-=c,n+=c);0>k&&0>l?(g="se",k=l=0):0>k?(g="ne",k=0):0>l&&(g="sw",l=0);break;case "sw":if(f){if(0>=a&&(m<=x||w>=u)){t=!1;break}k-=a;m+=a;l=k/f}else 0>=a?m>x?(k-=a,m+=a):0<=c&&w>=u&&(t=!1):(k-=a,m+=a),0<=c?w<u&&(l+=c):l+=c;0>k&&0>l?(g="ne",k=l=0):0>k?(g="se",k=0):0>l&&(g="nw",l=0);break;case "se":if(f){if(0<=a&&(p>=r||w>=u)){t=!1;break}k+=a;l=k/f}else 0<=a?p<r?k+=a:0<=c&&w>=u&&(t=!1):k+=a,0<=c?w<u&&(l+=c):l+=c;0>k&&0>l?(g="nw",k=l=0):0>k?(g="sw",k=0):0>l&&(g="ne",l=0);break;case "move":this.move(a,c);t=!1;break;case "zoom":this.zoom(function(a,b,c,d){a=M(a*a+b*b);return(M(c*c+d*d)-a)/a}(I(this.startX-this.startX2),I(this.startY-this.startY2),I(this.endX-this.endX2),I(this.endY-this.endY2)),b);this.startX2=this.endX2;this.startY2=this.endY2;t=!1;break;case "crop":a&&c?(b=this.$cropper.offset(),m=this.startX-b.left,n=this.startY-b.top,k=h.minWidth,l=h.minHeight,0<a?g=0<c?"se":"ne":0>a&&(m-=k,g=0<c?"sw":"nw"),0>c&&(n-=l),this.isCropped||(this.$cropBox.removeClass("cropper-hidden"),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))):t=!1}t&&(h.width=k,h.height=l,h.left=m,h.top=n,this.action=g,this.renderCropBox());this.startX=this.endX;this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass("cropper-modal"),this.$cropBox.removeClass("cropper-hidden")),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=l.extend({},this.initialImage),this.canvas=l.extend({},this.initialCanvas),this.cropBox=l.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(l.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass("cropper-modal"),this.$cropBox.addClass("cropper-hidden"))},replace:function(a,b){!this.isDisabled&&a&&(this.isImg&&this.$element.attr("src",a),b?(this.url=a,this.$clone.attr("src",a),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",a)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(a)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass("cropper-disabled"))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass("cropper-disabled"))},destroy:function(){var a=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&a.attr("src",this.originalUrl),this.unbuild(),a.removeClass("cropper-hidden")):this.isImg?a.off("load.cropper",this.start):this.$clone&&this.$clone.remove();a.removeData("cropper")},move:function(a,b){var c=this.canvas;this.moveTo(q(a)?a:c.left+z(a),q(b)?b:c.top+z(b))},moveTo:function(a,b){var c=this.canvas,d=!1;q(b)&&(b=a);a=z(a);b=z(b);this.isBuilt&&!this.isDisabled&&this.options.movable&&(g(a)&&(c.left=a,d=!0),g(b)&&(c.top=b,d=!0),d&&this.renderCanvas(!0))},zoom:function(a,b){var c=this.canvas;a=z(a);this.zoomTo(c.width*(0>a?1/(1-a):1+a)/c.naturalWidth,b)},zoomTo:function(a,b){var c=this.options,d=this.canvas,e=d.width,f=d.height,g=d.naturalWidth,h=d.naturalHeight,k;a=z(a);0<=a&&this.isBuilt&&!this.isDisabled&&c.zoomable&&(c=g*a,a*=h,b&&(k=b.originalEvent),this.trigger("zoom.cropper",{originalEvent:k,oldRatio:e/g,ratio:c/g}).isDefaultPrevented()||(k?(g=this.$cropper.offset(),b=k.touches?r(k.touches):{pageX:b.pageX||k.pageX||0,pageY:b.pageY||k.pageY||0},d.left-=(b.pageX-g.left-d.left)/e*(c-e),d.top-=(b.pageY-g.top-d.top)/f*(a-f)):(d.left-=(c-e)/2,d.top-=(a-f)/2),d.width=c,d.height=a,this.renderCanvas(!0)))},rotate:function(a){this.rotateTo((this.image.rotate||0)+z(a))},rotateTo:function(a){a=z(a);g(a)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=a%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(a,b){var c=this.image,d=!1;q(b)&&(b=a);a=z(a);b=z(b);this.isBuilt&&!this.isDisabled&&this.options.scalable&&(g(a)&&(c.scaleX=a,d=!0),g(b)&&(c.scaleY=b,d=!0),d&&this.renderImage(!0))},scaleX:function(a){var b=this.image.scaleY;this.scale(a,g(b)?b:1)},scaleY:function(a){var b=this.image.scaleX;this.scale(g(b)?b:1,a)},getData:function(a){var b=this.options,c=this.image,d=this.canvas,e=this.cropBox,f,g;this.isBuilt&&this.isCropped?(g={x:e.left-d.left,y:e.top-d.top,width:e.width,height:e.height},f=c.width/c.naturalWidth,l.each(g,function(b,c){c/=f;g[b]=a?E(c):c})):g={x:0,y:0,width:0,height:0};b.rotatable&&(g.rotate=c.rotate||0);b.scalable&&(g.scaleX=c.scaleX||1,g.scaleY=c.scaleY||1);return g},setData:function(a){var b=this.options,c=this.image,d=this.canvas,e={},f,h;l.isFunction(a)&&(a=a.call(this.element));this.isBuilt&&!this.isDisabled&&l.isPlainObject(a)&&(b.rotatable&&g(a.rotate)&&a.rotate!==c.rotate&&(c.rotate=a.rotate,this.isRotated=f=!0),b.scalable&&(g(a.scaleX)&&a.scaleX!==c.scaleX&&(c.scaleX=a.scaleX,h=!0),g(a.scaleY)&&a.scaleY!==c.scaleY&&(c.scaleY=a.scaleY,h=!0)),f?this.renderCanvas():h&&this.renderImage(),b=c.width/c.naturalWidth,g(a.x)&&(e.left=a.x*b+d.left),g(a.y)&&(e.top=a.y*b+d.top),g(a.width)&&(e.width=a.width*b),g(a.height)&&(e.height=a.height*b),this.setCropBoxData(e))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var a=this.canvas,b={};this.isBuilt&&l.each("left top width height naturalWidth naturalHeight".split(" "),function(c,d){b[d]=a[d]});return b},setCanvasData:function(a){var b=this.canvas,c=b.aspectRatio;l.isFunction(a)&&(a=a.call(this.$element));this.isBuilt&&!this.isDisabled&&l.isPlainObject(a)&&(g(a.left)&&(b.left=a.left),g(a.top)&&(b.top=a.top),g(a.width)?(b.width=a.width,b.height=a.width/c):g(a.height)&&(b.height=a.height,b.width=a.height*c),this.renderCanvas(!0))},getCropBoxData:function(){var a=this.cropBox,b;this.isBuilt&&this.isCropped&&(b={left:a.left,top:a.top,width:a.width,height:a.height});return b||{}},setCropBoxData:function(a){var b=this.cropBox,c=this.options.aspectRatio,d,e;l.isFunction(a)&&(a=a.call(this.$element));this.isBuilt&&this.isCropped&&!this.isDisabled&&l.isPlainObject(a)&&(g(a.left)&&(b.left=a.left),g(a.top)&&(b.top=a.top),g(a.width)&&(d=!0,b.width=a.width),g(a.height)&&(e=!0,b.height=a.height),c&&(d?b.height=b.width/c:e&&(b.width=b.height*c)),this.renderCropBox())},getCroppedCanvas:function(a){var b,c,e,f,g,h,k,m;if(this.isBuilt&&P){if(!this.isCropped)return d(this.$clone[0],this.image);l.isPlainObject(a)||(a={});m=this.getData();b=m.width;c=m.height;h=b/c;l.isPlainObject(a)&&(e=a.width,f=a.height,e?(f=e/h,g=e/b):f&&(e=f*h,g=f/c));e=K(e||b);f=K(f||c);h=l("\x3ccanvas\x3e")[0];h.width=e;h.height=f;k=h.getContext("2d");a.fillColor&&(k.fillStyle=a.fillColor,k.fillRect(0,0,e,f));k.drawImage.apply(k,function(){var a=d(this.$clone[0],this.image),e=a.width,f=a.height,h=this.canvas,a=[a],k=m.x+h.naturalWidth*(I(m.scaleX||1)-1)/2,h=m.y+h.naturalHeight*(I(m.scaleY||1)-1)/2,l,n,p,q,r,t;k<=-b||k>e?k=l=p=r=0:0>=k?(p=-k,k=0,l=r=B(e,b+k)):k<=e&&(p=0,l=r=B(b,e-k));0>=l||h<=-c||h>f?h=n=q=t=0:0>=h?(q=-h,h=0,n=t=B(f,c+h)):h<=f&&(q=0,n=t=B(c,f-h));a.push(K(k),K(h),K(l),K(n));g&&(p*=g,q*=g,r*=g,t*=g);0<r&&0<t&&a.push(K(p),K(q),K(r),K(t));return a}.call(this));return h}},setAspectRatio:function(a){var b=this.options;this.isDisabled||q(a)||(b.aspectRatio=C(0,a)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(a){var b=this.options,c,d;this.isLoaded&&!this.isDisabled&&(c="crop"===a,d=b.movable&&"move"===a,a=c||d?a:"none",this.$dragBox.data("action",a).toggleClass("cropper-crop",c).toggleClass("cropper-move",d),b.cropBoxMovable||this.$face.data("action",a).toggleClass("cropper-crop",c).toggleClass("cropper-move",d))}};n.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null};n.setDefaults=function(a){l.extend(n.DEFAULTS,a)};n.TEMPLATE='\x3cdiv class\x3d"cropper-container"\x3e\x3cdiv class\x3d"cropper-wrap-box"\x3e\x3cdiv class\x3d"cropper-canvas"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-drag-box"\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-crop-box"\x3e\x3cspan class\x3d"cropper-view-box"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-h"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-v"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-center"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-face"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-e" data-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-n" data-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-w" data-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-s" data-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-e" data-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-n" data-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-w" data-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-s" data-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-ne" data-action\x3d"ne"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-nw" data-action\x3d"nw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-sw" data-action\x3d"sw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-se" data-action\x3d"se"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e';n.other=l.fn.cropper;l.fn.cropper=function(a){var b=m(arguments,1),c;this.each(function(){var d=l(this),e=d.data("cropper"),f;if(!e){if(/destroy/.test(a))return;e=l.extend({},d.data(),l.isPlainObject(a)&&a);d.data("cropper",e=new n(this,e))}"string"===typeof a&&l.isFunction(f=e[a])&&(c=f.apply(e,b))});return q(c)?this:c};l.fn.cropper.Constructor=n;l.fn.cropper.setDefaults=n.setDefaults;l.fn.cropper.noConflict=function(){l.fn.cropper=n.other;return this}});