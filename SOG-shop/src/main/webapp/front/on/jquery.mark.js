(function(b){"function"===typeof define&&define.amd?define(["jquery"],b):b(window.jQuery||window.Zepto)})(function(b){var y=function(a,f,d){a=b(a);var g=this,p=a.val(),h;f="function"===typeof f?f(a.val(),void 0,a,d):f;var c={invalid:[],getCaret:function(){try{var e,n=0,b=a.get(0),c=document.selection,f=b.selectionStart;if(c&&-1===navigator.appVersion.indexOf("MSIE 10"))e=c.createRange(),e.moveStart("character",a.is("input")?-a.val().length:-a.text().length),n=e.text.length;else if(f||"0"===f)n=f;return n}catch(l){}},setCaret:function(e){try{if(a.is(":focus")){var n,c=a.get(0);c.setSelectionRange?c.setSelectionRange(e,e):c.createTextRange&&(n=c.createTextRange(),n.collapse(!0),n.moveEnd("character",e),n.moveStart("character",e),n.select())}}catch(k){}},events:function(){a.on("keyup.mask",c.behaviour).on("paste.mask drop.mask",function(){setTimeout(function(){a.keydown().keyup()},100)}).on("change.mask",function(){a.data("changed",!0)}).on("blur.mask",function(){p===a.val()||a.data("changed")||a.trigger("change");a.data("changed",!1)}).on("keydown.mask, blur.mask",function(){p=a.val()}).on("focusout.mask",function(){d.clearIfNotMatch&&!h.test(c.val())&&c.val("")})},getRegexMask:function(){for(var e=[],a,c,b,d,l=0;l<f.length;l++)(a=g.translation[f[l]])?(c=a.pattern.toString().replace(/.{1}$|^.{1}/g,""),b=a.optional,(a=a.recursive)?(e.push(f[l]),d={digit:f[l],pattern:c}):e.push(b||a?c+"?":c)):e.push(f[l].replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$\x26"));e=e.join("");d&&(e=e.replace(new RegExp("("+
d.digit+"(.*"+d.digit+")?)"),"($1)?").replace(new RegExp(d.digit,"g"),d.pattern));return new RegExp(e)},destroyEvents:function(){a.off("keydown keyup paste drop blur focusout ".split(" ").join(".mask "))},val:function(e){var c=a.is("input")?"val":"text";if(0<arguments.length){if(a[c]()!==e)a[c](e);c=a}else c=a[c]();return c},getMCharsBeforeCount:function(a,c){for(var e=0,b=0,d=f.length;b<d&&b<a;b++)g.translation[f.charAt(b)]||(a=c?a+1:a,e++);return e},caretPos:function(a,b,d,k){return g.translation[f.charAt(Math.min(a-
1,f.length-1))]?Math.min(a+d-b-k,d):c.caretPos(a+1,b,d,k)},behaviour:function(a){a=a||window.event;c.invalid=[];var e=a.keyCode||a.which;if(-1===b.inArray(e,g.byPassKeys)){var d=c.getCaret(),f=c.val().length,B=d<f,l=c.getMasked(),h=l.length,m=c.getMCharsBeforeCount(h-1)-c.getMCharsBeforeCount(f-1);c.val(l);!B||65===e&&a.ctrlKey||(8!==e&&46!==e&&(d=c.caretPos(d,f,h,m)),c.setCaret(d));return c.callbacks(a)}},getMasked:function(a){var b=[],e=c.val(),k=0,h=f.length,l=0,p=e.length,m=1,u="push",v=-1,t,q;d.reverse?(u="unshift",m=-1,t=0,k=h-1,l=p-1,q=function(){return-1<k&&-1<l}):(t=h-1,q=function(){return k<h&&l<p});for(;q();){var x=f.charAt(k),w=e.charAt(l),r=g.translation[x];if(r)w.match(r.pattern)?(b[u](w),r.recursive&&(-1===v?v=k:k===t&&(k=v-m),t===v&&(k-=m)),k+=m):r.optional?(k+=m,l-=m):r.fallback?(b[u](r.fallback),k+=m,l-=m):c.invalid.push({p:l,v:w,e:r.pattern}),l+=m;else{if(!a)b[u](x);w===x&&(l+=m);k+=m}}a=f.charAt(t);h!==p+1||g.translation[a]||b.push(a);return b.join("")},callbacks:function(b){var e=c.val(),g=e!==p,k=[e,b,a,d],h=function(a,b,c){"function"===typeof d[a]&&b&&d[a].apply(this,c)};h("onChange",!0===g,k);h("onKeyPress",!0===g,k);h("onComplete",e.length===f.length,k);h("onInvalid",0<c.invalid.length,[e,b,a,c.invalid,d])}};g.mask=f;g.options=d;g.remove=function(){var b=c.getCaret();c.destroyEvents();c.val(g.getCleanVal());c.setCaret(b-c.getMCharsBeforeCount(b));return a};g.getCleanVal=function(){return c.getMasked(!0)};g.init=function(e){e=e||!1;d=d||{};g.byPassKeys=b.jMaskGlobals.byPassKeys;g.translation=b.jMaskGlobals.translation;g.translation=b.extend({},g.translation,d.translation);g=b.extend(!0,{},g,d);h=c.getRegexMask();!1===e?(d.placeholder&&a.attr("placeholder",d.placeholder),a.attr("autocomplete","off"),c.destroyEvents(),c.events(),e=c.getCaret(),c.val(c.getMasked()),c.setCaret(e+c.getMCharsBeforeCount(e,!0))):(c.events(),c.val(c.getMasked()))};g.init(!a.is("input"))};b.maskWatchers={};var A=function(){var a=b(this),f={},d=a.attr("data-mask");a.attr("data-mask-reverse")&&(f.reverse=!0);a.attr("data-mask-clearifnotmatch")&&(f.clearIfNotMatch=!0);if(z(a,d,f))return a.data("mask",new y(this,d,f))},z=function(a,f,d){d=d||{};var g=b(a).data("mask"),h=JSON.stringify;a=b(a).val()||b(a).text();try{return"function"===typeof f&&(f=f(a)),"object"!==typeof g||h(g.options)!==h(d)||g.mask!==f}catch(q){}};b.fn.mask=function(a,f){f=f||{};var d=this.selector,g=b.jMaskGlobals,h=b.jMaskGlobals.watchInterval,q=function(){if(z(this,a,f))return b(this).data("mask",new y(this,a,f))};b(this).each(q);d&&""!==d&&g.watchInputs&&(clearInterval(b.maskWatchers[d]),b.maskWatchers[d]=setInterval(function(){b(document).find(d).each(q)},h))};b.fn.unmask=function(){clearInterval(b.maskWatchers[this.selector]);delete b.maskWatchers[this.selector];return this.each(function(){var a=b(this).data("mask");a&&a.remove().removeData("mask")})};b.fn.cleanVal=function(){return this.data("mask").getCleanVal()};var h={maskElements:"input,td,span,div",dataMaskAttr:"*[data-mask]",dataMask:!0,watchInterval:300,watchInputs:!0,watchDataMask:!1,byPassKeys:[9,16,17,18,36,37,38,39,40,91],translation:{0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}}};b.jMaskGlobals=b.jMaskGlobals||{};h=b.jMaskGlobals=b.extend(!0,{},h,b.jMaskGlobals);h.dataMask&&b(h.dataMaskAttr).each(A);setInterval(function(){b.jMaskGlobals.watchDataMask&&b(document).find(b.jMaskGlobals.maskElements).filter(h.dataMaskAttr).each(A)},h.watchInterval)});